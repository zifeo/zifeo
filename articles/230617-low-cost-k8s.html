<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><link rel="preload" as="font" href="/_next/static/media/b89f66ecdb077e7f-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/8cdcee85580da01e.css" data-precedence="next"/><meta name="next-size-adjust"/><title>Low-cost Kubernetes cluster on Infomaniak</title><meta name="description" content="How to deploy k8s on a $30.— monthly budget or less."/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="icon" href="/icon.svg?a05afc09b4abba7d" type="image/svg+xml" sizes="260x260"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__className_9c5fe4 bg-white "><div class="container my-16"><div class="flex gap-4 items-center"><div class="grow-0"><a href="/"><noscript><img alt="Teo&#x27;s picture" loading="lazy" width="100" height="100" decoding="async" data-nimg="1" class="rounded-full" style="color:transparent" srcSet="/images/optimized/teo-opt-128.WEBP 1x, /images/optimized/teo-opt-256.WEBP 2x" src="/images/optimized/teo-opt-256.WEBP"/></noscript><img alt="Teo&#x27;s picture" loading="lazy" width="100" height="100" decoding="async" data-nimg="1" class="rounded-full" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(/images/optimized/teo-opt-10.WEBP);filter:url(#sharpBlur)" srcSet="/images/optimized/teo-opt-128.WEBP 1x, /images/optimized/teo-opt-256.WEBP 2x" src="/images/optimized/teo-opt-256.WEBP"/><svg style="border:0;clip:rect(0 0 0 0);height:0;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px"><filter id="sharpBlur"><feGaussianBlur stdDeviation="20" color-interpolation-filters="sRGB"></feGaussianBlur><feColorMatrix type="matrix" color-interpolation-filters="sRGB" values="1 0 0 0 0, 0 1 0 0 0, 0 0 1 0 0, 0 0 0 9 0"></feColorMatrix><feComposite in2="SourceGraphic" operator="in"></feComposite></filter></svg></a></div><div class="grow flex flex-col space-y-1"><a href="/"><h1>Teo Stocco</h1></a><p>Chief of Technology at KiWi</p><nav class="flex gap-1 text-xs uppercase"><ul><li><a href="https://linkedin.com/in/zifeo" title="Teo&#x27;s LinkedIn">LinkedIn</a></li></ul><ul><li><a href="https://github.com/zifeo" title="Teo&#x27;s GitHub">GitHub</a></li></ul><ul><li><a href="https://twitter.com/zifeo" title="Teo&#x27;s Twitter">Twitter</a></li></ul><ul><li><a href="https://dev.to/zifeo" title="Teo&#x27;s DevTo">DevTo</a></li></ul></nav></div></div></div><main class="container my-16 flex flex-col space-y-8"><div class="flex justify-between text-sm"><div class="group"><a class="group-hover:no-underline text-zinc-500" href="/">← <span class="group-hover:underline text-zinc-500">Back</span></a></div><div><a href="https://github.com/zifeo/zifeo/edit/main/content/articles/230617-low-cost-k8s.mdx" class="text-zinc-500">Edit/improve on Github</a></div></div><article class="flex flex-col space-y-4"><h2 id="low-cost-kubernetes-cluster-on-infomaniak"><a href="#low-cost-kubernetes-cluster-on-infomaniak">Low-cost Kubernetes cluster on Infomaniak</a></h2>
<p><a href="https://kubernetes.io">Kubernetes</a> (k8s) is becoming the de facto standard for container orchestration. While it provides convenient abstractions and solves many pain points, it is not as accessible as running a local copy of Docker<sup><a href="#user-content-fn-1" id="user-content-fnref-1" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>. This makes it harder to learn and get real hands-on experience without being part of a DevOps team or getting ruined quickly.</p>
<p>When looking at popular Kubernetes providers and without going into their complex pricing structure, the lowest price one can find for a managed Kubernetes is roughly $55/month for 4cpu and 15Go<sup><a href="#user-content-fn-2" id="user-content-fnref-2" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup> of RAM available (June 2023).</p>
<table><thead><tr><th>Provider</th><th>Region</th><th>Cluster fees</th><th>4cpu / 15Go</th><th>Note</th></tr></thead><tbody><tr><td>GKE</td><td>Frankfurt</td><td>$73/month</td><td>$126</td><td>$74.40/month of free credit</td></tr><tr><td>AWS</td><td>Frankfurt</td><td>$73/month</td><td>$112</td><td></td></tr><tr><td>AKS</td><td>West Germany</td><td>Free</td><td>$112</td><td>$73/month for pro cluster</td></tr><tr><td>Linode</td><td>Frankfurt</td><td>$36</td><td>$72</td><td>Only 8Go RAM</td></tr><tr><td>Scaleway</td><td>Paris</td><td>Free</td><td>$73</td><td>98% API server availability<sup><a href="#user-content-fn-3" id="user-content-fnref-3" data-footnote-ref="true" aria-describedby="footnote-label">3</a></sup></td></tr><tr><td>OVH</td><td>Frankfurt</td><td>Free</td><td>$55</td><td></td></tr><tr><td>Exoscale</td><td>Frankfurt</td><td>Free</td><td>$136</td><td>$40/month for pro cluster</td></tr><tr><td>DigitalOcean</td><td>Frankfurt</td><td>Free</td><td>$126</td><td>$40/month for pro cluster</td></tr></tbody></table>
<p>At that price, it becomes interesting to look at reasonably priced VMs providers like Hetzner or Infomaniak, and install Kubernetes directly on it. This comes at the cost of managing the cluster ourselves and maintaining it over time. While this offers a good learning opportunity, it may also be a source of frustration as the setup can be non-trivial. For this reason, the <a href="https://docs.rke2.io">RKE2</a> distribution of Kubernetes is a great pick as it offers a good balance between features, security and simplicity.</p>
<p>Regarding the hardware provider, Infomaniak offers currently better price than Hetzner<sup><a href="#user-content-fn-4" id="user-content-fnref-4" data-footnote-ref="true" aria-describedby="footnote-label">4</a></sup> and especially gives us with direct access to OpenStack, a well-known open source platform to provision infrastructure (also offered by OVH). This makes it easier to manage the resources using code (IaC) and comes with a good support for Terraform.</p>
<h3 id="getting-started"><a href="#getting-started">Getting started</a></h3>
<p>You will need an <a href="https://welcome.infomaniak.com/signup">account on Infomaniak</a>, a valid credit card and <a href="https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli">Terraform installed</a>.</p>
<p>Once you have your Infomaniak account, go on the <a href="https://www.infomaniak.com/fr/hebergement/public-cloud">Public Cloud landing page</a> and click on &quot;get started&quot;. Pick a name for your public cloud and enter your credit card details in the checkout page. You will be charged at the end of the month for the resources you used. Note that as of the time of writing this article, Infomaniak offers up to CHF 300.— of free credit during the first 3 months.</p>
<img src="230617-low-cost-k8s/public-cloud-creation.png" width="300" class="mx-auto" alt="Creating a Public Cloud"/>
<p>You should then see an empty list of OpenStack project (also called tenant in the OpenStack jargon). Click on the &quot;create a project&quot; on the top right, choose a project name and a password for the autogenerated user and click on &quot;create&quot;. After a few seconds, you should be redirected to the list of projects and see your newly created project.</p>
<img src="230617-low-cost-k8s/public-cloud-projects-list.png" width="800" class="mx-auto" alt="List of OpenStack projects"/>
<p>You can then click on the project name, and you will be directed on <a href="https://api.pub1.infomaniak.cloud/horizon/auth/login/">Horizon</a>, the user interface of OpenStack which is useful to follow the progress of the cluster creation.</p>
<img src="230617-low-cost-k8s/horizon-welcome.png" width="800" height="300" class="mx-auto"/>
<h3 id="terraform-openstack-rke2-module"><a href="#terraform-openstack-rke2-module">Terraform OpenStack RKE2 module</a></h3>
<p>Now, you are jumping into the interesting part. You will use <a href="https://registry.terraform.io/modules/zifeo/rke2/openstack/latest">the Terraform OpenStack RKE2 module</a> that takes care of the heavy lifting and deploy a RKE2 cluster on OpenStack for you. Create a new directory and open a <code>main.tf</code> file with the following content:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="hcl" data-theme="default"><code data-language="hcl" data-theme="default"><span class="line"><span style="color:#6F42C1">variable</span><span style="color:#24292E"> </span><span style="color:#005CC5">&quot;project&quot;</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  type</span><span style="color:#E36209"> </span><span style="color:#D73A49">=</span><span style="color:#E36209"> </span><span style="color:#D73A49">string</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">variable</span><span style="color:#24292E"> </span><span style="color:#005CC5">&quot;username&quot;</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  type</span><span style="color:#E36209"> </span><span style="color:#D73A49">=</span><span style="color:#E36209"> </span><span style="color:#D73A49">string</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">variable</span><span style="color:#24292E"> </span><span style="color:#005CC5">&quot;password&quot;</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  type</span><span style="color:#E36209"> </span><span style="color:#D73A49">=</span><span style="color:#E36209"> </span><span style="color:#D73A49">string</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># authenticate with OpenStack</span></span>
<span class="line"><span style="color:#6F42C1">provider</span><span style="color:#24292E"> </span><span style="color:#005CC5">&quot;openstack&quot;</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  tenant_name</span><span style="color:#E36209"> </span><span style="color:#D73A49">=</span><span style="color:#E36209"> </span><span style="color:#24292E">var</span><span style="color:#D73A49">.</span><span style="color:#24292E">project</span></span>
<span class="line"><span style="color:#24292E">  user_name</span><span style="color:#E36209">   </span><span style="color:#D73A49">=</span><span style="color:#E36209"> </span><span style="color:#24292E">var</span><span style="color:#D73A49">.</span><span style="color:#24292E">username</span></span>
<span class="line"><span style="color:#24292E">  password</span><span style="color:#E36209">    </span><span style="color:#D73A49">=</span><span style="color:#E36209"> </span><span style="color:#24292E">var</span><span style="color:#D73A49">.</span><span style="color:#24292E">password</span></span>
<span class="line"><span style="color:#24292E">  auth_url</span><span style="color:#E36209">    </span><span style="color:#D73A49">=</span><span style="color:#E36209"> </span><span style="color:#032F62">&quot;https://api.pub1.infomaniak.cloud/identity&quot;</span></span>
<span class="line"><span style="color:#24292E">  region</span><span style="color:#E36209">      </span><span style="color:#D73A49">=</span><span style="color:#E36209"> </span><span style="color:#032F62">&quot;dc3-a&quot;</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># dependency management</span></span>
<span class="line"><span style="color:#6F42C1">terraform</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  required_version</span><span style="color:#E36209"> </span><span style="color:#D73A49">=</span><span style="color:#E36209"> </span><span style="color:#032F62">&quot;&gt;= 0.14.0&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  </span><span style="color:#6F42C1">required_providers</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    openstack</span><span style="color:#E36209"> </span><span style="color:#D73A49">=</span><span style="color:#E36209"> </span><span style="color:#24292E">{</span></span>
<span class="line"><span style="color:#24292E">      source  </span><span style="color:#D73A49">=</span><span style="color:#24292E"> </span><span style="color:#032F62">&quot;terraform-provider-openstack/openstack&quot;</span></span>
<span class="line"><span style="color:#24292E">      version </span><span style="color:#D73A49">=</span><span style="color:#24292E"> </span><span style="color:#032F62">&quot;&gt;= 1.51.1&quot;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div>
<p>This creates 3 variables that will be used to authenticate to the OpenStack API and configure the OpenStack provider and ensure that the latter is using the expected version. If you would like to avoid having to enter your credentials each time, you can create a <code>terraform.tfvars</code> (make sure to add this file to your <code>gitignore</code> and never accidentally share that file) or check the alternative <a href="https://registry.terraform.io/providers/terraform-provider-openstack/openstack/latest/docs#configuration-reference">authentication methods</a> of the provider (e.g. <code>cloud</code> with <code>clouds.yaml</code>):</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="yaml" data-theme="default"><code data-language="yaml" data-theme="default"><span class="line"><span style="color:#032F62">project=PCP-XXXXXXXX</span></span>
<span class="line"><span style="color:#032F62">username=PCU-XXXXXXXX</span></span>
<span class="line"><span style="color:#032F62">password=XXXXXXXX</span></span></code></pre></div>
<p>You will now declare a cluster with 1 server and 1 agent nodes in <code>main.tf</code>:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="hcl" data-theme="default"><code data-language="hcl" data-theme="default"><span class="line"><span style="color:#6F42C1">module</span><span style="color:#24292E"> </span><span style="color:#005CC5">&quot;rke2&quot;</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  source</span><span style="color:#E36209"> </span><span style="color:#D73A49">=</span><span style="color:#E36209"> </span><span style="color:#032F62">&quot;zifeo/rke2/openstack&quot;</span></span>
<span class="line"><span style="color:#24292E">  </span><span style="color:#6A737D"># fixing the version is recommended (follows semantic versioning)</span></span>
<span class="line"><span style="color:#24292E">  version</span><span style="color:#E36209"> </span><span style="color:#D73A49">=</span><span style="color:#E36209"> </span><span style="color:#032F62">&quot;2.0.3&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  </span><span style="color:#6A737D"># must be true for single server cluster or</span></span>
<span class="line"><span style="color:#24292E">  </span><span style="color:#6A737D"># only on the first run for high-availability cluster</span></span>
<span class="line"><span style="color:#24292E">  bootstrap</span><span style="color:#E36209"> </span><span style="color:#D73A49">=</span><span style="color:#E36209"> </span><span style="color:#005CC5">true</span></span>
<span class="line"><span style="color:#24292E">  name</span><span style="color:#E36209">      </span><span style="color:#D73A49">=</span><span style="color:#E36209"> </span><span style="color:#032F62">&quot;single-server&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  </span><span style="color:#6A737D"># path to your public key, in order to connect to the instances</span></span>
<span class="line"><span style="color:#24292E">  ssh_authorized_keys</span><span style="color:#E36209"> </span><span style="color:#D73A49">=</span><span style="color:#E36209"> </span><span style="color:#24292E">[</span><span style="color:#032F62">&quot;~/.ssh/id_rsa.pub&quot;</span><span style="color:#24292E">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  </span><span style="color:#6A737D"># name of the public OpenStack network to use for the server IP</span></span>
<span class="line"><span style="color:#24292E">  floating_pool</span><span style="color:#E36209"> </span><span style="color:#D73A49">=</span><span style="color:#E36209"> </span><span style="color:#032F62">&quot;ext-floating1&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  </span><span style="color:#6A737D"># allow access from any IP</span></span>
<span class="line"><span style="color:#24292E">  </span><span style="color:#6A737D"># it should ideally be restricted to a secure bastion</span></span>
<span class="line"><span style="color:#24292E">  rules_ssh_cidr</span><span style="color:#E36209"> </span><span style="color:#D73A49">=</span><span style="color:#E36209"> </span><span style="color:#032F62">&quot;0.0.0.0/0&quot;</span></span>
<span class="line"><span style="color:#24292E">  rules_k8s_cidr</span><span style="color:#E36209"> </span><span style="color:#D73A49">=</span><span style="color:#E36209"> </span><span style="color:#032F62">&quot;0.0.0.0/0&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  </span><span style="color:#6A737D"># servers hosts Kubernetes control plane + etcd</span></span>
<span class="line"><span style="color:#24292E">  </span><span style="color:#6A737D"># and are the only ones exposed to the internet</span></span>
<span class="line"><span style="color:#24292E">  servers</span><span style="color:#E36209"> </span><span style="color:#D73A49">=</span><span style="color:#E36209"> </span><span style="color:#24292E">[{</span></span>
<span class="line"><span style="color:#24292E">    name </span><span style="color:#D73A49">=</span><span style="color:#24292E"> </span><span style="color:#032F62">&quot;server&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    </span><span style="color:#6A737D"># 2 cpu and 4Go of RAM is the minimum recommended per server</span></span>
<span class="line"><span style="color:#24292E">    flavor_name </span><span style="color:#D73A49">=</span><span style="color:#24292E"> </span><span style="color:#032F62">&quot;a2-ram4-disk0&quot;</span></span>
<span class="line"><span style="color:#24292E">    image_name  </span><span style="color:#D73A49">=</span><span style="color:#24292E"> </span><span style="color:#032F62">&quot;Ubuntu 22.04 LTS Jammy Jellyfish&quot;</span></span>
<span class="line"><span style="color:#24292E">    system_user </span><span style="color:#D73A49">=</span><span style="color:#24292E"> </span><span style="color:#032F62">&quot;ubuntu&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    </span><span style="color:#6A737D"># size of the operating system disk</span></span>
<span class="line"><span style="color:#24292E">    boot_volume_size </span><span style="color:#D73A49">=</span><span style="color:#24292E"> </span><span style="color:#005CC5">4</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    </span><span style="color:#6A737D"># size of the volume for the RKE2 data (persisted on single-server)</span></span>
<span class="line"><span style="color:#24292E">    rke2_volume_size </span><span style="color:#D73A49">=</span><span style="color:#24292E"> </span><span style="color:#005CC5">8</span></span>
<span class="line"><span style="color:#24292E">    rke2_version     </span><span style="color:#D73A49">=</span><span style="color:#24292E"> </span><span style="color:#032F62">&quot;v1.26.4+rke2r1&quot;</span></span>
<span class="line"><span style="color:#24292E">  }]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  </span><span style="color:#6A737D"># agents runs your workloads</span></span>
<span class="line"><span style="color:#24292E">  </span><span style="color:#6A737D"># and are not exposed to the internet (doable with a load balancer)</span></span>
<span class="line"><span style="color:#24292E">  agents</span><span style="color:#E36209"> </span><span style="color:#D73A49">=</span><span style="color:#E36209"> </span><span style="color:#24292E">[</span></span>
<span class="line"><span style="color:#24292E">    {</span></span>
<span class="line"><span style="color:#24292E">      name        </span><span style="color:#D73A49">=</span><span style="color:#24292E"> </span><span style="color:#032F62">&quot;agent-a&quot;</span></span>
<span class="line"><span style="color:#24292E">      nodes_count </span><span style="color:#D73A49">=</span><span style="color:#24292E"> </span><span style="color:#005CC5">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">      </span><span style="color:#6A737D"># a2-ram4-disk0 is the minimal meaningful config for agents</span></span>
<span class="line"><span style="color:#24292E">      </span><span style="color:#6A737D"># you can also directly go for a4-ram16-disk0 as in the intro</span></span>
<span class="line"><span style="color:#24292E">      flavor_name </span><span style="color:#D73A49">=</span><span style="color:#24292E"> </span><span style="color:#032F62">&quot;a2-ram4-disk0&quot;</span></span>
<span class="line"><span style="color:#24292E">      image_name  </span><span style="color:#D73A49">=</span><span style="color:#24292E"> </span><span style="color:#032F62">&quot;Ubuntu 22.04 LTS Jammy Jellyfish&quot;</span></span>
<span class="line"><span style="color:#24292E">      system_user </span><span style="color:#D73A49">=</span><span style="color:#24292E"> </span><span style="color:#032F62">&quot;ubuntu&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">      boot_volume_size </span><span style="color:#D73A49">=</span><span style="color:#24292E"> </span><span style="color:#005CC5">4</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">      rke2_volume_size </span><span style="color:#D73A49">=</span><span style="color:#24292E"> </span><span style="color:#005CC5">8</span></span>
<span class="line"><span style="color:#24292E">      rke2_version     </span><span style="color:#D73A49">=</span><span style="color:#24292E"> </span><span style="color:#032F62">&quot;v1.26.4+rke2r1&quot;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">  ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  </span><span style="color:#6A737D"># enable automatically agent removal of the cluster</span></span>
<span class="line"><span style="color:#24292E">  ff_autoremove_agent</span><span style="color:#E36209"> </span><span style="color:#D73A49">=</span><span style="color:#E36209"> </span><span style="color:#005CC5">true</span></span>
<span class="line"><span style="color:#24292E">  </span><span style="color:#6A737D"># output the kubeconfig to the current directory</span></span>
<span class="line"><span style="color:#24292E">  ff_write_kubeconfig</span><span style="color:#E36209"> </span><span style="color:#D73A49">=</span><span style="color:#E36209"> </span><span style="color:#005CC5">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  identity_endpoint</span><span style="color:#E36209"> </span><span style="color:#D73A49">=</span><span style="color:#E36209"> </span><span style="color:#032F62">&quot;https://api.pub1.infomaniak.cloud/identity&quot;</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div>
<p>And you are ready to go! Run the following commands and wait a few minutes for the cluster to be created (a few more are required to have all the pods running after the core is ready):</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="bash" data-theme="default"><code data-language="bash" data-theme="default"><span class="line"><span style="color:#6F42C1">terraform</span><span style="color:#24292E"> </span><span style="color:#032F62">init</span></span>
<span class="line"><span style="color:#6A737D"># ...</span></span>
<span class="line"><span style="color:#6A737D"># Terraform has been successfully initialized!</span></span>
<span class="line"><span style="color:#6A737D"># ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">terraform</span><span style="color:#24292E"> </span><span style="color:#032F62">apply</span></span>
<span class="line"><span style="color:#6A737D"># ...</span></span>
<span class="line"><span style="color:#6A737D"># Plan: 71 to add, 0 to change, 0 to destroy.</span></span>
<span class="line"><span style="color:#6A737D">#</span></span>
<span class="line"><span style="color:#6A737D"># Do you want to perform these actions?</span></span>
<span class="line"><span style="color:#6A737D">#   Terraform will perform the actions described above.</span></span>
<span class="line"><span style="color:#6A737D">#   Only &#x27;yes&#x27; will be accepted to approve.</span></span>
<span class="line"><span style="color:#6A737D">#</span></span>
<span class="line"><span style="color:#6A737D">#   Enter a value: yes</span></span>
<span class="line"><span style="color:#6A737D"># ...</span></span>
<span class="line"><span style="color:#6A737D"># Apply complete! Resources: 71 added, 0 changed, 0 destroyed.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">cat</span><span style="color:#24292E"> </span><span style="color:#032F62">single-server.rke2.yaml</span></span>
<span class="line"><span style="color:#6A737D"># apiVersion: v1</span></span>
<span class="line"><span style="color:#6A737D"># kind: config</span></span>
<span class="line"><span style="color:#6A737D"># ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">export</span><span style="color:#24292E"> KUBECONFIG</span><span style="color:#D73A49">=</span><span style="color:#032F62">single-server.rke2.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">kubectl</span><span style="color:#24292E"> </span><span style="color:#032F62">get</span><span style="color:#24292E"> </span><span style="color:#032F62">pods</span><span style="color:#24292E"> </span><span style="color:#005CC5">--all-namespaces</span></span>
<span class="line"><span style="color:#6A737D"># NAMESPACE     NAME                                                    READY   STATUS              RESTARTS   AGE</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   helm-install-openstack-cinder-csi-2rp9z                 0/1     Pending             0          2s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   helm-install-openstack-cloud-controller-manager-4wdzt   0/1     ContainerCreating   0          2s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   helm-install-rke2-cilium-s5skd                          0/1     ContainerCreating   0          2s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   helm-install-rke2-coredns-kc4ld                         0/1     ContainerCreating   0          2s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   helm-install-rke2-metrics-server-ttt84                  0/1     Pending             0          2s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   helm-install-rke2-snapshot-controller-crd-2sdzt         0/1     Pending             0          2s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   helm-install-rke2-snapshot-controller-xqzsk             0/1     Pending             0          2s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   helm-install-rke2-snapshot-validation-webhook-5w9lw     0/1     Pending             0          2s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   helm-install-velero-4zhq7                               0/1     Pending             0          2s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   kube-apiserver-single-server-server-1                   1/1     Running             0          12s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   kube-controller-manager-single-server-server-1          1/1     Running             0          16s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   kube-scheduler-single-server-server-1                   1/1     Running             0          15s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">kubectl</span><span style="color:#24292E"> </span><span style="color:#032F62">get</span><span style="color:#24292E"> </span><span style="color:#032F62">pods</span><span style="color:#24292E"> </span><span style="color:#005CC5">--all-namespaces</span></span>
<span class="line"><span style="color:#6A737D"># NAMESPACE     NAME                                                    READY   STATUS      RESTARTS   AGE</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   cilium-ngcrp                                            1/1     Running     0          2m39s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   cilium-operator-b947b9d8d-zc92l                         1/1     Running     0          2m39s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   cilium-qt7vr                                            1/1     Running     0          2m39s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   etcd-single-server-server-1                             1/1     Running     0          2m42s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   helm-install-openstack-cinder-csi-2rp9z                 0/1     Completed   0          2m52s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   helm-install-openstack-cloud-controller-manager-4wdzt   0/1     Completed   0          2m52s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   helm-install-rke2-cilium-s5skd                          0/1     Completed   0          2m52s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   helm-install-rke2-coredns-kc4ld                         0/1     Completed   0          2m52s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   helm-install-rke2-metrics-server-ttt84                  0/1     Completed   0          2m52s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   helm-install-rke2-snapshot-controller-crd-2sdzt         0/1     Completed   0          2m52s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   helm-install-rke2-snapshot-controller-xqzsk             0/1     Completed   0          2m52s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   helm-install-rke2-snapshot-validation-webhook-5w9lw     0/1     Completed   0          2m52s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   helm-install-velero-4zhq7                               0/1     Completed   0          2m52s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   kube-apiserver-single-server-server-1                   1/1     Running     0          3m2s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   kube-controller-manager-single-server-server-1          1/1     Running     0          3m6s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   kube-scheduler-single-server-server-1                   1/1     Running     0          3m5s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   openstack-cinder-csi-controllerplugin-cf5f9869d-xbmtv   6/6     Running     0          2m39s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   openstack-cinder-csi-nodeplugin-zghjj                   3/3     Running     0          98s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   openstack-cloud-controller-manager-bffxb                1/1     Running     0          2m19s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   rke2-coredns-rke2-coredns-autoscaler-597fb897d7-p8k7j   1/1     Running     0          2m41s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   rke2-coredns-rke2-coredns-f6f4ff467-6lrgl               1/1     Running     0          83s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   rke2-coredns-rke2-coredns-f6f4ff467-shlrv               1/1     Running     0          2m41s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   rke2-metrics-server-67d6554d69-8vhrt                    1/1     Running     0          78s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   rke2-snapshot-controller-6b9c678c77-2txzn               1/1     Running     0          77s</span></span>
<span class="line"><span style="color:#6A737D"># kube-system   rke2-snapshot-validation-webhook-6c9d7f868c-qnqdq       1/1     Running     0          77s</span></span>
<span class="line"><span style="color:#6A737D"># velero        restic-g8mvb                                            1/1     Running     0          30s</span></span>
<span class="line"><span style="color:#6A737D"># velero        velero-5b67659997-67zgd                                 1/1     Running     0          30s</span></span></code></pre></div>
<p>You can also explore your cluster using Horizon (see instances and components of the network).</p>
<img src="230617-low-cost-k8s/horizon-instances.png" width="800" class="mx-auto" alt="List of instances"/>
<p>Congratulations, you just have installed your first Kubernetes cluster with RKE2! You can find more information about the module and its features (etcd backups, upgrades, volume snapshots, etc.) on the <a href="https://github.com/zifeo/terraform-openstack-rke2">repository</a>. Give a star ⭐️ if you like it or raise an issue there if you find a bug 🐛.</p>
<h3 id="cluster-architecture"><a href="#cluster-architecture">Cluster architecture</a></h3>
<p>The cluster is composed of 2 subnets inside a private network only reachable by the load-balancer. Many security rules control the traffic between the servers and the agents. You can add more using the <code>rules_server_server</code>, <code>rules_server_agent</code> or <code>rules_agent_server</code> parameters. The load-balancer exposes by default only an SSH endpoint and the Kubernetes API server from the server nodes. These can be closed with the <code>rules_ssh_cidr</code> and <code>rules_k8s_cidr</code> parameters.</p>
<img src="230617-low-cost-k8s/architecture.drawio.svg" width="350" class="mx-auto" alt="Cluster architecture"/>
<p>For high-availablity (HA) setup, you will need a minimum of 3 server nodes. You can add more nodes and they will automatically join the cluster when ready (do not forget to remove the bootstrap flag for that).</p>
<h3 id="cost-projections"><a href="#cost-projections">Cost projections</a></h3>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mn>2</mn><mo>⋅</mo><mn>5.8</mn><msub><mn>8</mn><mtext>instance</mtext></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><mn>2</mn><mo>⋅</mo><mo stretchy="false">(</mo><mn>4</mn><mo>+</mo><mn>6</mn><mo stretchy="false">)</mo><mo>⋅</mo><mn>0.0</mn><msub><mn>9</mn><mtext>block storage</mtext></msub><mo>+</mo><mn>3.3</mn><msub><mn>4</mn><mtext>IP</mtext></msub><mo>+</mo><mn>1</mn><msub><mn>0</mn><mtext>load-balancer</mtext></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mn>26.90</mn><mtext> CHF/month</mtext><mo>≈</mo><mn>30</mn><mtext> USD/month</mtext></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
2\cdot 5.88_\text{instance} &amp;+ 2\cdot(4+6)\cdot0.09_\text{block storage} + 3.34_\text{IP} + 10_\text{load-balancer}\\
&amp;= 26.90 \text{ CHF/month}\approx 30\text{ USD/month}
\end{align*}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em"><span style="top:-3.91em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord">5.8</span><span class="mord"><span class="mord">8</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3175em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">instance</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em"><span class="pstrut" style="height:3em"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em"><span style="top:-3.91em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mopen">(</span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord">6</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord">0.0</span><span class="mord"><span class="mord">9</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">block storage</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord">3.3</span><span class="mord"><span class="mord">4</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">IP</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">load-balancer</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord">26.90</span><span class="mord text"><span class="mord"> CHF/month</span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mord">30</span><span class="mord text"><span class="mord"> USD/month</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em"><span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>The majority of the cost comes from the network where the module uses a load-balancer which is not strictly required for single server clusters. However, this allows to keep all nodes in a private network and only expose allowed ports on the load-balancer to the outside.</p>
<p>In practice, more disk space is needed for the operating system (minimum advised: 16Go) and for the RKE2 data (minimum advised: 32Go), bringing the cost closer to what OVH was offering with its managed version, yet about 25% cheaper for single server. At the same price, you get a HA setup. However, adding more nodes shows how well the pricing of Infomaniak scales compared to other alternatives.</p>
<table><thead><tr><th>Configuration</th><th>CHF/month</th><th>USD/month</th></tr></thead><tbody><tr><td><strong>single 2cpu/4go server with 1x4cpu/15Go agent</strong></td><td><strong>~37.—</strong></td><td><strong>~41.—</strong></td></tr><tr><td>3x2cpu/4go HA servers with 1x4cpu/15Go agent</td><td>~50.—</td><td>~56.—</td></tr><tr><td>3x2cpu/4go HA servers with 3x4cpu/15Go agents</td><td>~85.—</td><td>~95.—</td></tr></tbody></table>
<p>Previous versions of the module used a floating IP and the Virtual Router Redundancy Protocol (VRRP) via <a href="https://github.com/acassen/keepalived">keepalived</a> on the server nodes. Tweaking a bit the RKE2 config, it was possible to reach a cost of 11.— CHF/month (~12.— USD/month) with 1 cpu and 2Go of RAM for both the server and the agent. This was a cheaper solution, however the convenience of the load-balancer is worth the extra money.</p>
<p>Note that the load-balancer can be shared by multiple Kubernetes services using the following annotation (you can find the UUID in the Horizon dashboard):</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="yaml" data-theme="default"><code data-language="yaml" data-theme="default"><span class="line"><span style="color:#22863A">loadbalancer.openstack.org/load-balancer-id</span><span style="color:#24292E">: </span><span style="color:#032F62">&quot;uuid-of-the-load-balancer&quot;</span></span></code></pre></div>
<h3 id="conclusion"><a href="#conclusion">Conclusion</a></h3>
<p>As seen, setting up a Kubernetes cluster from scratch can be an interesting and cheaper alternative to using managed ones. However, it will require regular maintenance and some additional initial efforts. It offers a great way to learn and acquire practical experience with Kubernetes. If you are looking for a managed solution on Infomaniak to benefit from the great pricing, <a href="https://exponent.ch">Exponent.ch</a> offers a managed service on your own account.</p>
<section data-footnotes="true" class="footnotes"><h3 class="sr-only" id="footnote-label"><a href="#footnote-label">Footnotes</a></h3>
<ol>
<li id="user-content-fn-1">
<p><a href="https://github.com/kubernetes/minikube">Minikube</a> and <a href="https://github.com/kubernetes-sigs/kind">kind</a> offer local clusters, however it will not expose you to the reality of running a cluster on multiple nodes. <a href="#user-content-fnref-1" data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content">↩</a></p>
</li>
<li id="user-content-fn-2">
<p>In practice each agent consume some resources to run the Kubernetes components (network and node controller), so the article assumes 1Go less of RAM available and 200m less of cpu. <a href="#user-content-fnref-2" data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content">↩</a></p>
</li>
<li id="user-content-fn-3">
<p>This comes from my own experience and was acknowledged by their support in 2022. <a href="#user-content-fnref-3" data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content">↩</a></p>
</li>
<li id="user-content-fn-4">
<p>The Hetzner community maintains also a great <a href="https://github.com/kube-hetzner/terraform-hcloud-kube-hetzner">Terraform module</a>. <a href="#user-content-fnref-4" data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content">↩</a></p>
</li>
</ol>
</section></article><div class="flex items-center gap-2 flex-col"><p>Get an email for new updates, nothing more!</p><form class="border-zinc-500 border rounded-md overflow-hidden grid grid-cols-5"><input type="email" required="" placeholder="Your email" class="px-2 py-1 outline-none col-span-3" value=""/><input type="submit" class="px-2 py-1 cursor-pointer bg-zinc-500 text-white rounded-l-md hover:bg-zinc-700 transition duration-200 ease-in-out col-span-2" value="Subscribe"/></form></div><div class="flex justify-between text-sm"><div class="group"><a class="group-hover:no-underline text-zinc-500" href="/">← <span class="group-hover:underline text-zinc-500">Back</span></a></div><div><a href="https://github.com/zifeo/zifeo/edit/main/content/articles/230617-low-cost-k8s.mdx" class="text-zinc-500">Edit/improve on Github</a></div></div></main><div class="container my-16"><div class="flex flex-col space-y-4"><nav class="flex gap-1 text-xs uppercase"><ul><li><a href="https://linkedin.com/in/zifeo" title="Teo&#x27;s LinkedIn">LinkedIn</a></li></ul><ul><li><a href="https://github.com/zifeo" title="Teo&#x27;s GitHub">GitHub</a></li></ul><ul><li><a href="https://twitter.com/zifeo" title="Teo&#x27;s Twitter">Twitter</a></li></ul><ul><li><a href="https://dev.to/zifeo" title="Teo&#x27;s DevTo">DevTo</a></li></ul></nav><p class="leading-5 text-sm">© Teo Stocco. Texts and images are available under the<!-- --> <a href="https://creativecommons.org/licenses/by-sa/4.0/" title="Attribution-ShareAlike 4.0 International license" class="hover:text-black hover:underline underline-offset-4 decoration-2 decoration-zinc-800">Creative Commons Attribution-ShareAlike 4.0 license</a>, unless stated otherwise. Website<!-- -->&#x27;<!-- -->s<!-- --> <a href="https://github.com/zifeo/zifeo" title="Website source code on GitHub" class="hover:text-black hover:underline underline-offset-4 decoration-2 decoration-zinc-800">source code</a> <!-- -->is available under the<!-- --> <a href="https://github.com/zifeo/zifeo/blob/main/LICENSE.md" title="Mozilla Public License 2.0" class="hover:text-black hover:underline underline-offset-4 decoration-2 decoration-zinc-800">Mozilla Public License 2.0</a>.</p></div></div><script src="/_next/static/chunks/webpack-2e46fb135c2c9d5c.js" async=""></script><script src="/_next/static/chunks/575debc0-4e28034878eb198c.js" async=""></script><script src="/_next/static/chunks/524-10ac6af07dcbd016.js" async=""></script><script src="/_next/static/chunks/main-app-f5c01defa09a3279.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/b89f66ecdb077e7f-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/8cdcee85580da01e.css\",{\"as\":\"style\"}]\n0:\"$L3\"\n"])</script><script>self.__next_f.push([1,"4:I{\"id\":\"8778\",\"chunks\":[\"272:static/chunks/webpack-2e46fb135c2c9d5c.js\",\"501:static/chunks/575debc0-4e28034878eb198c.js\",\"524:static/chunks/524-10ac6af07dcbd016.js\"],\"name\":\"\",\"async\":false}\n6:I{\"id\":\"8314\",\"chunks\":[\"272:static/chunks/webpack-2e46fb135c2c9d5c.js\",\"501:static/chunks/575debc0-4e28034878eb198c.js\",\"524:static/chunks/524-10ac6af07dcbd016.js\"],\"name\":\"\",\"async\":false}\n7:I{\"id\":\"5904\",\"chunks\":[\"904:static/chunks/904-3b7da9442574e30e.js\",\"20:static/chunks/app/state-of/[state_of]/layout-1a97517"])</script><script>self.__next_f.push([1,"95f38a5e3.js\"],\"name\":\"\",\"async\":false}\n8:I{\"id\":\"7096\",\"chunks\":[\"609:static/chunks/609-83638cdf1dda4012.js\",\"943:static/chunks/app/state-of/[state_of]/page-8abee18184a3de1f.js\"],\"name\":\"ExportedImage\",\"async\":false}\na:I{\"id\":\"7718\",\"chunks\":[\"272:static/chunks/webpack-2e46fb135c2c9d5c.js\",\"501:static/chunks/575debc0-4e28034878eb198c.js\",\"524:static/chunks/524-10ac6af07dcbd016.js\"],\"name\":\"\",\"async\":false}\nb:I{\"id\":\"4765\",\"chunks\":[\"272:static/chunks/webpack-2e46fb135c2c9d5c.js\",\"501:static/chunks/575debc0"])</script><script>self.__next_f.push([1,"-4e28034878eb198c.js\",\"524:static/chunks/524-10ac6af07dcbd016.js\"],\"name\":\"\",\"async\":false}\nd:I{\"id\":\"1537\",\"chunks\":[\"904:static/chunks/904-3b7da9442574e30e.js\",\"20:static/chunks/app/state-of/[state_of]/layout-1a9751795f38a5e3.js\"],\"name\":\"Newsletter\",\"async\":false}\ne:I{\"id\":\"4536\",\"chunks\":[\"904:static/chunks/904-3b7da9442574e30e.js\",\"772:static/chunks/app/articles/[article]/layout-4060bb5693effe10.js\"],\"name\":\"Giscus\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"3:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/8cdcee85580da01e.css\",\"precedence\":\"next\"}]],[\"$\",\"$L4\",null,{\"buildId\":\"T8H8P4fHA5e4AfUaoE1P2\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/articles/230617-low-cost-k8s\",\"initialTree\":[\"\",{\"children\":[\"articles\",{\"children\":[[\"article\",\"230617-low-cost-k8s\",\"d\"],{\"children\":[\"__PAGE__?{\\\"article\\\":\\\"230617-low-cost-k8s\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[\"$L5\",[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\"}]],\"globalErrorComponent\":\"$6\",\"notFound\":[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__className_9c5fe4 bg-white \",\"children\":[[\"$\",\"div\",null,{\"className\":\"container my-16\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex gap-4 items-center\",\"children\":[[\"$\",\"div\",null,{\"className\":\"grow-0\",\"children\":[\"$\",\"$L7\",null,{\"href\":\"/\",\"children\":[\"$\",\"$L8\",null,{\"src\":\"/images/teo.jpg\",\"alt\":\"Teo's picture\",\"width\":100,\"height\":100,\"className\":\"rounded-full\"}]}]}],[\"$\",\"div\",null,{\"className\":\"grow flex flex-col space-y-1\",\"children\":[[\"$\",\"$L7\",null,{\"href\":\"/\",\"children\":[\"$\",\"h1\",null,{\"children\":\"Teo Stocco\"}]}],[\"$\",\"p\",null,{\"children\":\"Chief of Technology at KiWi\"}],[\"$\",\"nav\",null,{\"className\":\"flex gap-1 text-xs uppercase\",\"children\":[[\"$\",\"ul\",\"https://linkedin.com/in/zifeo\",{\"children\":[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://linkedin.com/in/zifeo\",\"title\":\"Teo's LinkedIn\",\"children\":\"LinkedIn\"}]}]}],[\"$\",\"ul\",\"https://github.com/zifeo\",{\"children\":[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/zifeo\",\"title\":\"Teo's GitHub\",\"children\":\"GitHub\"}]}]}],[\"$\",\"ul\",\"https://twitter.com/zifeo\",{\"children\":[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://twitter.com/zifeo\",\"title\":\"Teo's Twitter\",\"children\":\"Twitter\"}]}]}],[\"$\",\"ul\",\"https://dev.to/zifeo\",{\"children\":[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://dev.to/zifeo\",\"title\":\"Teo's DevTo\",\"children\":\"DevTo\"}]}]}]]}]]}]]}]}],[\"$L9\",[],[\"$\",\"main\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"container my-16 flex flex-col space-y-4\",\"children\":[[\"$\",\"h2\",null,{\"children\":\"Not Found\"}],[\"$\",\"p\",null,{\"children\":[\"Return to the \",[\"$\",\"$L7\",null,{\"href\":\"/\",\"children\":\"homepage\"}],\".\"]}]]}]}]],[\"$\",\"div\",null,{\"className\":\"container my-16\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col space-y-4\",\"children\":[[\"$\",\"nav\",null,{\"className\":\"flex gap-1 text-xs uppercase\",\"children\":[[\"$\",\"ul\",\"https://linkedin.com/in/zifeo\",{\"children\":[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://linkedin.com/in/zifeo\",\"title\":\"Teo's LinkedIn\",\"children\":\"LinkedIn\"}]}]}],[\"$\",\"ul\",\"https://github.com/zifeo\",{\"children\":[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/zifeo\",\"title\":\"Teo's GitHub\",\"children\":\"GitHub\"}]}]}],[\"$\",\"ul\",\"https://twitter.com/zifeo\",{\"children\":[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://twitter.com/zifeo\",\"title\":\"Teo's Twitter\",\"children\":\"Twitter\"}]}]}],[\"$\",\"ul\",\"https://dev.to/zifeo\",{\"children\":[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://dev.to/zifeo\",\"title\":\"Teo's DevTo\",\"children\":\"DevTo\"}]}]}]]}],[\"$\",\"p\",null,{\"className\":\"leading-5 text-sm\",\"children\":[\"© Teo Stocco. Texts and images are available under the\",\" \",[\"$\",\"a\",null,{\"href\":\"https://creativecommons.org/licenses/by-sa/4.0/\",\"title\":\"Attribution-ShareAlike 4.0 International license\",\"className\":\"hover:text-black hover:underline underline-offset-4 decoration-2 decoration-zinc-800\",\"children\":\"Creative Commons Attribution-ShareAlike 4.0 license\"}],\", unless stated otherwise. Website\",\"'\",\"s\",\" \",[\"$\",\"a\",null,{\"href\":\"https://github.com/zifeo/zifeo\",\"title\":\"Website source code on GitHub\",\"className\":\"hover:text-black hover:underline underline-offset-4 decoration-2 decoration-zinc-800\",\"children\":\"source code\"}],\" \",\"is available under the\",\" \",[\"$\",\"a\",null,{\"href\":\"https://github.com/zifeo/zifeo/blob/main/LICENSE.md\",\"title\":\"Mozilla Public License 2.0\",\"className\":\"hover:text-black hover:underline underline-offset-4 decoration-2 decoration-zinc-800\",\"children\":\"Mozilla Public License 2.0\"}],\".\"]}]]}]}]]}]}],\"asNotFound\":false,\"children\":[[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__className_9c5fe4 bg-white \",\"children\":[[\"$\",\"div\",null,{\"className\":\"container my-16\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex gap-4 items-center\",\"children\":[[\"$\",\"div\",null,{\"className\":\"grow-0\",\"children\":[\"$\",\"$L7\",null,{\"href\":\"/\",\"children\":[\"$\",\"$L8\",null,{\"src\":\"/images/teo.jpg\",\"alt\":\"Teo's picture\",\"width\":100,\"height\":100,\"className\":\"rounded-full\"}]}]}],[\"$\",\"div\",null,{\"className\":\"grow flex flex-col space-y-1\",\"children\":[[\"$\",\"$L7\",null,{\"href\":\"/\",\"children\":[\"$\",\"h1\",null,{\"children\":\"Teo Stocco\"}]}],[\"$\",\"p\",null,{\"children\":\"Chief of Technology at KiWi\"}],[\"$\",\"nav\",null,{\"className\":\"flex gap-1 text-xs uppercase\",\"children\":[[\"$\",\"ul\",\"https://linkedin.com/in/zifeo\",{\"children\":[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://linkedin.com/in/zifeo\",\"title\":\"Teo's LinkedIn\",\"children\":\"LinkedIn\"}]}]}],[\"$\",\"ul\",\"https://github.com/zifeo\",{\"children\":[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/zifeo\",\"title\":\"Teo's GitHub\",\"children\":\"GitHub\"}]}]}],[\"$\",\"ul\",\"https://twitter.com/zifeo\",{\"children\":[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://twitter.com/zifeo\",\"title\":\"Teo's Twitter\",\"children\":\"Twitter\"}]}]}],[\"$\",\"ul\",\"https://dev.to/zifeo\",{\"children\":[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://dev.to/zifeo\",\"title\":\"Teo's DevTo\",\"children\":\"DevTo\"}]}]}]]}]]}]]}]}],[\"$\",\"$La\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":[\"$\",\"main\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"container my-16 flex flex-col space-y-4\",\"children\":[[\"$\",\"h2\",null,{\"children\":\"Not Found\"}],[\"$\",\"p\",null,{\"children\":[\"Return to the \",[\"$\",\"$L7\",null,{\"href\":\"/\",\"children\":\"homepage\"}],\".\"]}]]}]}],\"notFoundStyles\":[],\"childProp\":{\"current\":[\"$\",\"$La\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"articles\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[[\"$\",\"main\",null,{\"className\":\"container my-16 flex flex-col space-y-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex justify-between text-sm\",\"children\":[[\"$\",\"div\",null,{\"className\":\"group\",\"children\":[\"$\",\"$L7\",null,{\"href\":\"/\",\"className\":\"group-hover:no-underline text-zinc-500\",\"children\":[\"← \",[\"$\",\"span\",null,{\"className\":\"group-hover:underline text-zinc-500\",\"children\":\"Back\"}]]}]}],[\"$\",\"div\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/zifeo/zifeo/edit/main/content/articles/230617-low-cost-k8s.mdx\",\"className\":\"text-zinc-500\",\"children\":\"Edit/improve on Github\"}]}]]}],[\"$\",\"$La\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"articles\",\"children\",[\"article\",\"230617-low-cost-k8s\",\"d\"],\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$Lc\",null],\"segment\":\"__PAGE__?{\\\"article\\\":\\\"230617-low-cost-k8s\\\"}\"},\"styles\":[]}],[\"$\",\"$Ld\",null,{}],[\"$\",\"div\",null,{\"className\":\"flex justify-between text-sm\",\"children\":[[\"$\",\"div\",null,{\"className\":\"group\",\"children\":[\"$\",\"$L7\",null,{\"href\":\"/\",\"className\":\"group-hover:no-underline text-zinc-500\",\"children\":[\"← \",[\"$\",\"span\",null,{\"className\":\"group-hover:underline text-zinc-500\",\"children\":\"Back\"}]]}]}],[\"$\",\"div\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/zifeo/zifeo/edit/main/content/articles/230617-low-cost-k8s.mdx\",\"className\":\"text-zinc-500\",\"children\":\"Edit/improve on Github\"}]}]]}],[\"$\",\"$Le\",null,{}]]}],null],\"segment\":[\"article\",\"230617-low-cost-k8s\",\"d\"]},\"styles\":[]}],\"segment\":\"articles\"},\"styles\":[]}],[\"$\",\"div\",null,{\"className\":\"container my-16\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col space-y-4\",\"children\":[[\"$\",\"nav\",null,{\"className\":\"flex gap-1 text-xs uppercase\",\"children\":[[\"$\",\"ul\",\"https://linkedin.com/in/zifeo\",{\"children\":[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://linkedin.com/in/zifeo\",\"title\":\"Teo's LinkedIn\",\"children\":\"LinkedIn\"}]}]}],[\"$\",\"ul\",\"https://github.com/zifeo\",{\"children\":[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/zifeo\",\"title\":\"Teo's GitHub\",\"children\":\"GitHub\"}]}]}],[\"$\",\"ul\",\"https://twitter.com/zifeo\",{\"children\":[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://twitter.com/zifeo\",\"title\":\"Teo's Twitter\",\"children\":\"Twitter\"}]}]}],[\"$\",\"ul\",\"https://dev.to/zifeo\",{\"children\":[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://dev.to/zifeo\",\"title\":\"Teo's DevTo\",\"children\":\"DevTo\"}]}]}]]}],[\"$\",\"p\",null,{\"className\":\"leading-5 text-sm\",\"children\":[\"© Teo Stocco. Texts and images are available under the\",\" \",[\"$\",\"a\",null,{\"href\":\"https://creativecommons.org/licenses/by-sa/4.0/\",\"title\":\"Attribution-ShareAlike 4.0 International license\",\"className\":\"hover:text-black hover:underline underline-offset-4 decoration-2 decoration-zinc-800\",\"children\":\"Creative Commons Attribution-ShareAlike 4.0 license\"}],\", unless stated otherwise. Website\",\"'\",\"s\",\" \",[\"$\",\"a\",null,{\"href\":\"https://github.com/zifeo/zifeo\",\"title\":\"Website source code on GitHub\",\"className\":\"hover:text-black hover:underline underline-offset-4 decoration-2 decoration-zinc-800\",\"children\":\"source code\"}],\" \",\"is available under the\",\" \",[\"$\",\"a\",null,{\"href\":\"https://github.com/zifeo/zifeo/blob/main/LICENSE.md\",\"title\":\"Mozilla Public License 2.0\",\"className\":\"hover:text-black hover:underline underline-offset-4 decoration-2 decoration-zinc-800\",\"children\":\"Mozilla Public License 2.0\"}],\".\"]}]]}]}]]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"c:[\"$\",\"article\",null,{\"className\":\"flex flex-col space-y-4\",\"children\":[[\"$\",\"h2\",null,{\"id\":\"low-cost-kubernetes-cluster-on-infomaniak\",\"children\":[\"$\",\"a\",null,{\"href\":\"#low-cost-kubernetes-cluster-on-infomaniak\",\"children\":\"Low-cost Kubernetes cluster on Infomaniak\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"https://kubernetes.io\",\"children\":\"Kubernetes\"}],\" (k8s) is becoming the de facto standard for container orchestration. While it provides convenient abstractions and solves many pain points, it is not as accessible as running a local copy of Docker\",[\"$\",\"sup\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#user-content-fn-1\",\"id\":\"user-content-fnref-1\",\"data-footnote-ref\":true,\"aria-describedby\":\"footnote-label\",\"children\":\"1\"}]}],\". This makes it harder to learn and get real hands-on experience without being part of a DevOps team or getting ruined quickly.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"When looking at popular Kubernetes providers and without going into their complex pricing structure, the lowest price one can find for a managed Kubernetes is roughly $55/month for 4cpu and 15Go\",[\"$\",\"sup\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#user-content-fn-2\",\"id\":\"user-content-fnref-2\",\"data-footnote-ref\":true,\"aria-describedby\":\"footnote-label\",\"children\":\"2\"}]}],\" of RAM available (June 2023).\"]}],\"\\n\",[\"$\",\"table\",null,{\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"Provider\"}],[\"$\",\"th\",null,{\"children\":\"Region\"}],[\"$\",\"th\",null,{\"children\":\"Cluster fees\"}],[\"$\",\"th\",null,{\"children\":\"4cpu / 15Go\"}],[\"$\",\"th\",null,{\"children\":\"Note\"}]]}]}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"GKE\"}],[\"$\",\"td\",null,{\"children\":\"Frankfurt\"}],[\"$\",\"td\",null,{\"children\":\"$$73/month\"}],[\"$\",\"td\",null,{\"children\":\"$$126\"}],[\"$\",\"td\",null,{\"children\":\"$$74.40/month of free credit\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"AWS\"}],[\"$\",\"td\",null,{\"children\":\"Frankfurt\"}],[\"$\",\"td\",null,{\"children\":\"$$73/month\"}],[\"$\",\"td\",null,{\"children\":\"$$112\"}],[\"$\",\"td\",null,{}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"AKS\"}],[\"$\",\"td\",null,{\"children\":\"West Germany\"}],[\"$\",\"td\",null,{\"children\":\"Free\"}],[\"$\",\"td\",null,{\"children\":\"$$112\"}],[\"$\",\"td\",null,{\"children\":\"$$73/month for pro cluster\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"Linode\"}],[\"$\",\"td\",null,{\"children\":\"Frankfurt\"}],[\"$\",\"td\",null,{\"children\":\"$$36\"}],[\"$\",\"td\",null,{\"children\":\"$$72\"}],[\"$\",\"td\",null,{\"children\":\"Only 8Go RAM\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"Scaleway\"}],[\"$\",\"td\",null,{\"children\":\"Paris\"}],[\"$\",\"td\",null,{\"children\":\"Free\"}],[\"$\",\"td\",null,{\"children\":\"$$73\"}],[\"$\",\"td\",null,{\"children\":[\"98% API server availability\",[\"$\",\"sup\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#user-content-fn-3\",\"id\":\"user-content-fnref-3\",\"data-footnote-ref\":true,\"aria-describedby\":\"footnote-label\",\"children\":\"3\"}]}]]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"OVH\"}],[\"$\",\"td\",null,{\"children\":\"Frankfurt\"}],[\"$\",\"td\",null,{\"children\":\"Free\"}],[\"$\",\"td\",null,{\"children\":\"$$55\"}],[\"$\",\"td\",null,{}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"Exoscale\"}],[\"$\",\"td\",null,{\"children\":\"Frankfurt\"}],[\"$\",\"td\",null,{\"children\":\"Free\"}],[\"$\",\"td\",null,{\"children\":\"$$136\"}],[\"$\",\"td\",null,{\"children\":\"$$40/month for pro cluster\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"DigitalOcean\"}],[\"$\",\"td\",null,{\"children\":\"Frankfurt\"}],[\"$\",\"td\",null,{\"children\":\"Free\"}],[\"$\",\"td\",null,{\"children\":\"$$126\"}],[\"$\",\"td\",null,{\"children\":\"$$40/month for pro cluster\"}]]}]]}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"At that price, it becomes interesting to look at reasonably priced VMs providers like Hetzner or Infomaniak, and install Kubernetes directly on it. This comes at the cost of managing the cluster ourselves and maintaining it over time. While this offers a good learning opportunity, it may also be a source of frustration as the setup can be non-trivial. For this reason, the \",[\"$\",\"a\",null,{\"href\":\"https://docs.rke2.io\",\"children\":\"RKE2\"}],\" distribution of Kubernetes is a great pick as it offers a good balance between features, security and simplicity.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Regarding the hardware provider, Infomaniak offers currently better price than Hetzner\",[\"$\",\"sup\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"#user-content-fn-4\",\"id\":\"user-content-fnref-4\",\"data-footnote-ref\":true,\"aria-describedby\":\"footnote-label\",\"children\":\"4\"}]}],\" and especially gives us with direct access to OpenStack, a well-known open source platform to provision infrastructure (also offered by OVH). This makes it easier to manage the resources using code (IaC) and comes with a good support for Terraform.\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"getting-started\",\"children\":[\"$\",\"a\",null,{\"href\":\"#getting-started\",\"children\":\"Getting started\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"You will need an \",[\"$\",\"a\",null,{\"href\":\"https://welcome.infomaniak.com/signup\",\"children\":\"account on Infomaniak\"}],\", a valid credit card and \",[\"$\",\"a\",null,{\"href\":\"https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli\",\"children\":\"Terraform installed\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Once you have your Infomaniak account, go on the \",[\"$\",\"a\",null,{\"href\":\"https://www.infomaniak.com/fr/hebergement/public-cloud\",\"children\":\"Public Cloud landing page\"}],\" and click on \\\"get started\\\". Pick a name for your public cloud and enter your credit card details in the checkout page. You will be charged at the end of the month for the resources you used. Note that as of the time of writing this article, Infomaniak offers up to CHF 300.— of free credit during the first 3 months.\"]}],\"\\n\",[\"$\",\"img\",null,{\"src\":\"230617-low-cost-k8s/public-cloud-creation.png\",\"width\":\"300\",\"class\":\"mx-auto\",\"alt\":\"Creating a Public Cloud\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"You should then see an empty list of OpenStack project (also called tenant in the OpenStack jargon). Click on the \\\"create a project\\\" on the top right, choose a project name and a password for the autogenerated user and click on \\\"create\\\". After a few seconds, you should be redirected to the list of projects and see your newly created project.\"}],\"\\n\",[\"$\",\"img\",null,{\"src\":\"230617-low-cost-k8s/public-cloud-projects-list.png\",\"width\":\"800\",\"class\":\"mx-auto\",\"alt\":\"List of OpenStack projects\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"You can then click on the project name, and you will be directed on \",[\"$\",\"a\",null,{\"href\":\"https://api.pub1.infomaniak.cloud/horizon/auth/login/\",\"children\":\"Horizon\"}],\", the user interface of OpenStack which is useful to follow the progress of the cluster creation.\"]}],\"\\n\",[\"$\",\"img\",null,{\"src\":\"230617-low-cost-k8s/horizon-welcome.png\",\"width\":\"800\",\"height\":\"300\",\"class\":\"mx-auto\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"terraform-openstack-rke2-module\",\"children\":[\"$\",\"a\",null,{\"href\":\"#terraform-openstack-rke2-module\",\"children\":\"Terraform OpenStack RKE2 module\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Now, you are jumping into the interesting part. You will use \",[\"$\",\"a\",null,{\"href\":\"https://registry.terraform.io/modules/zifeo/rke2/openstack/latest\",\"children\":\"the Terraform OpenStack RKE2 module\"}],\" that takes care of the heavy lifting and deploy a RKE2 cluster on OpenStack for you. Create a new directory and open a \",[\"$\",\"code\",null,{\"children\":\"main.tf\"}],\" file with the following content:\"]}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"data-language\":\"hcl\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"hcl\",\"data-theme\":\"default\",\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"variable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"\\\"project\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  type\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"variable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"\\\"username\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  type\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"variable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"\\\"password\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  type\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# authenticate with OpenStack\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"provider\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"\\\"openstack\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  tenant_name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"project\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  user_name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\"   \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"username\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  password\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"password\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  auth_url\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"https://api.pub1.infomaniak.cloud/identity\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  region\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"dc3-a\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# dependency management\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"terraform\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  required_version\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"\u003e= 0.14.0\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"required_providers\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    openstack\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      source  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"terraform-provider-openstack/openstack\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      version \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"\u003e= 1.51.1\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"This creates 3 variables that will be used to authenticate to the OpenStack API and configure the OpenStack provider and ensure that the latter is using the expected version. If you would like to avoid having to enter your credentials each time, you can create a \",[\"$\",\"code\",null,{\"children\":\"terraform.tfvars\"}],\" (make sure to add this file to your \",[\"$\",\"code\",null,{\"children\":\"gitignore\"}],\" and never accidentally share that file) or check the alternative \",[\"$\",\"a\",null,{\"href\":\"https://registry.terraform.io/providers/terraform-provider-openstack/openstack/latest/docs#configuration-reference\",\"children\":\"authentication methods\"}],\" of the provider (e.g. \",[\"$\",\"code\",null,{\"children\":\"cloud\"}],\" with \",[\"$\",\"code\",null,{\"children\":\"clouds.yaml\"}],\"):\"]}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"data-language\":\"yaml\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"yaml\",\"data-theme\":\"default\",\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"project=PCP-XXXXXXXX\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"username=PCU-XXXXXXXX\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"password=XXXXXXXX\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"You will now declare a cluster with 1 server and 1 agent nodes in \",[\"$\",\"code\",null,{\"children\":\"main.tf\"}],\":\"]}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"data-language\":\"hcl\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"hcl\",\"data-theme\":\"default\",\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"module\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"\\\"rke2\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  source\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"zifeo/rke2/openstack\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# fixing the version is recommended (follows semantic versioning)\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  version\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"2.0.3\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# must be true for single server cluster or\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# only on the first run for high-availability cluster\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  bootstrap\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"true\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"single-server\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# path to your public key, in order to connect to the instances\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  ssh_authorized_keys\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"[\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"~/.ssh/id_rsa.pub\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"]\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# name of the public OpenStack network to use for the server IP\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  floating_pool\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"ext-floating1\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# allow access from any IP\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# it should ideally be restricted to a secure bastion\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  rules_ssh_cidr\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"0.0.0.0/0\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  rules_k8s_cidr\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"0.0.0.0/0\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# servers hosts Kubernetes control plane + etcd\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# and are the only ones exposed to the internet\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  servers\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"[{\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    name \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"server\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# 2 cpu and 4Go of RAM is the minimum recommended per server\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    flavor_name \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"a2-ram4-disk0\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    image_name  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"Ubuntu 22.04 LTS Jammy Jellyfish\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    system_user \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"ubuntu\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# size of the operating system disk\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    boot_volume_size \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"4\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# size of the volume for the RKE2 data (persisted on single-server)\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    rke2_volume_size \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"8\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    rke2_version     \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"v1.26.4+rke2r1\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  }]\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# agents runs your workloads\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# and are not exposed to the internet (doable with a load balancer)\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  agents\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"[\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    {\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      name        \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"agent-a\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      nodes_count \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"1\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# a2-ram4-disk0 is the minimal meaningful config for agents\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# you can also directly go for a4-ram16-disk0 as in the intro\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      flavor_name \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"a2-ram4-disk0\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      image_name  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"Ubuntu 22.04 LTS Jammy Jellyfish\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      system_user \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"ubuntu\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      boot_volume_size \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"4\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      rke2_volume_size \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"8\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      rke2_version     \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"v1.26.4+rke2r1\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  ]\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# enable automatically agent removal of the cluster\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  ff_autoremove_agent\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"true\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# output the kubeconfig to the current directory\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  ff_write_kubeconfig\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"true\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  identity_endpoint\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#E36209\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"https://api.pub1.infomaniak.cloud/identity\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"And you are ready to go! Run the following commands and wait a few minutes for the cluster to be created (a few more are required to have all the pods running after the core is ready):\"}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"data-language\":\"bash\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"bash\",\"data-theme\":\"default\",\"children\":[[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"terraform\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"init\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# ...\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# Terraform has been successfully initialized!\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# ...\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"terraform\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"apply\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# ...\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# Plan: 71 to add, 0 to change, 0 to destroy.\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"#\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# Do you want to perform these actions?\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"#   Terraform will perform the actions described above.\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"#   Only 'yes' will be accepted to approve.\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"#\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"#   Enter a value: yes\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# ...\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# Apply complete! Resources: 71 added, 0 changed, 0 destroyed.\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"cat\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"single-server.rke2.yaml\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# apiVersion: v1\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kind: config\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# ...\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"export\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" KUBECONFIG\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"single-server.rke2.yaml\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"kubectl\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"pods\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"--all-namespaces\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# NAMESPACE     NAME                                                    READY   STATUS              RESTARTS   AGE\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   helm-install-openstack-cinder-csi-2rp9z                 0/1     Pending             0          2s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   helm-install-openstack-cloud-controller-manager-4wdzt   0/1     ContainerCreating   0          2s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   helm-install-rke2-cilium-s5skd                          0/1     ContainerCreating   0          2s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   helm-install-rke2-coredns-kc4ld                         0/1     ContainerCreating   0          2s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   helm-install-rke2-metrics-server-ttt84                  0/1     Pending             0          2s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   helm-install-rke2-snapshot-controller-crd-2sdzt         0/1     Pending             0          2s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   helm-install-rke2-snapshot-controller-xqzsk             0/1     Pending             0          2s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   helm-install-rke2-snapshot-validation-webhook-5w9lw     0/1     Pending             0          2s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   helm-install-velero-4zhq7                               0/1     Pending             0          2s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   kube-apiserver-single-server-server-1                   1/1     Running             0          12s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   kube-controller-manager-single-server-server-1          1/1     Running             0          16s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   kube-scheduler-single-server-server-1                   1/1     Running             0          15s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\"}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"kubectl\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"pods\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"--all-namespaces\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# NAMESPACE     NAME                                                    READY   STATUS      RESTARTS   AGE\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   cilium-ngcrp                                            1/1     Running     0          2m39s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   cilium-operator-b947b9d8d-zc92l                         1/1     Running     0          2m39s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   cilium-qt7vr                                            1/1     Running     0          2m39s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   etcd-single-server-server-1                             1/1     Running     0          2m42s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   helm-install-openstack-cinder-csi-2rp9z                 0/1     Completed   0          2m52s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   helm-install-openstack-cloud-controller-manager-4wdzt   0/1     Completed   0          2m52s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   helm-install-rke2-cilium-s5skd                          0/1     Completed   0          2m52s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   helm-install-rke2-coredns-kc4ld                         0/1     Completed   0          2m52s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   helm-install-rke2-metrics-server-ttt84                  0/1     Completed   0          2m52s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   helm-install-rke2-snapshot-controller-crd-2sdzt         0/1     Completed   0          2m52s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   helm-install-rke2-snapshot-controller-xqzsk             0/1     Completed   0          2m52s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   helm-install-rke2-snapshot-validation-webhook-5w9lw     0/1     Completed   0          2m52s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   helm-install-velero-4zhq7                               0/1     Completed   0          2m52s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   kube-apiserver-single-server-server-1                   1/1     Running     0          3m2s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   kube-controller-manager-single-server-server-1          1/1     Running     0          3m6s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   kube-scheduler-single-server-server-1                   1/1     Running     0          3m5s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   openstack-cinder-csi-controllerplugin-cf5f9869d-xbmtv   6/6     Running     0          2m39s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   openstack-cinder-csi-nodeplugin-zghjj                   3/3     Running     0          98s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   openstack-cloud-controller-manager-bffxb                1/1     Running     0          2m19s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   rke2-coredns-rke2-coredns-autoscaler-597fb897d7-p8k7j   1/1     Running     0          2m41s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   rke2-coredns-rke2-coredns-f6f4ff467-6lrgl               1/1     Running     0          83s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   rke2-coredns-rke2-coredns-f6f4ff467-shlrv               1/1     Running     0          2m41s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   rke2-metrics-server-67d6554d69-8vhrt                    1/1     Running     0          78s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   rke2-snapshot-controller-6b9c678c77-2txzn               1/1     Running     0          77s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# kube-system   rke2-snapshot-validation-webhook-6c9d7f868c-qnqdq       1/1     Running     0          77s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# velero        restic-g8mvb                                            1/1     Running     0          30s\"}]}],\"\\n\",[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"# velero        velero-5b67659997-67zgd                                 1/1     Running     0          30s\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"You can also explore your cluster using Horizon (see instances and components of the network).\"}],\"\\n\",[\"$\",\"img\",null,{\"src\":\"230617-low-cost-k8s/horizon-instances.png\",\"width\":\"800\",\"class\":\"mx-auto\",\"alt\":\"List of instances\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Congratulations, you just have installed your first Kubernetes cluster with RKE2! You can find more information about the module and its features (etcd backups, upgrades, volume snapshots, etc.) on the \",[\"$\",\"a\",null,{\"href\":\"https://github.com/zifeo/terraform-openstack-rke2\",\"children\":\"repository\"}],\". Give a star ⭐️ if you like it or raise an issue there if you find a bug 🐛.\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"cluster-architecture\",\"children\":[\"$\",\"a\",null,{\"href\":\"#cluster-architecture\",\"children\":\"Cluster architecture\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The cluster is composed of 2 subnets inside a private network only reachable by the load-balancer. Many security rules control the traffic between the servers and the agents. You can add more using the \",[\"$\",\"code\",null,{\"children\":\"rules_server_server\"}],\", \",[\"$\",\"code\",null,{\"children\":\"rules_server_agent\"}],\" or \",[\"$\",\"code\",null,{\"children\":\"rules_agent_server\"}],\" parameters. The load-balancer exposes by default only an SSH endpoint and the Kubernetes API server from the server nodes. These can be closed with the \",[\"$\",\"code\",null,{\"children\":\"rules_ssh_cidr\"}],\" and \",[\"$\",\"code\",null,{\"children\":\"rules_k8s_cidr\"}],\" parameters.\"]}],\"\\n\",[\"$\",\"img\",null,{\"src\":\"230617-low-cost-k8s/architecture.drawio.svg\",\"width\":\"350\",\"class\":\"mx-auto\",\"alt\":\"Cluster architecture\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"For high-availablity (HA) setup, you will need a minimum of 3 server nodes. You can add more nodes and they will automatically join the cluster when ready (do not forget to remove the bootstrap flag for that).\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"cost-projections\",\"children\":[\"$\",\"a\",null,{\"href\":\"#cost-projections\",\"children\":\"Cost projections\"}]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"math math-display\",\"children\":[\"$\",\"span\",null,{\"className\":\"katex-display\",\"children\":[\"$\",\"span\",null,{\"className\":\"katex\",\"children\":[[\"$\",\"span\",null,{\"className\":\"katex-mathml\",\"children\":[\"$\",\"math\",null,{\"xmlns\":\"http://www.w3.org/1998/Math/MathML\",\"display\":\"block\",\"children\":[\"$\",\"semantics\",null,{\"children\":[[\"$\",\"mtable\",null,{\"rowspacing\":\"0.25em\",\"columnalign\":\"right left\",\"columnspacing\":\"0em\",\"children\":[[\"$\",\"mtr\",null,{\"children\":[[\"$\",\"mtd\",null,{\"children\":[\"$\",\"mstyle\",null,{\"scriptlevel\":\"0\",\"displaystyle\":\"true\",\"children\":[\"$\",\"mrow\",null,{\"children\":[[\"$\",\"mn\",null,{\"children\":\"2\"}],[\"$\",\"mo\",null,{\"children\":\"⋅\"}],[\"$\",\"mn\",null,{\"children\":\"5.8\"}],[\"$\",\"msub\",null,{\"children\":[[\"$\",\"mn\",null,{\"children\":\"8\"}],[\"$\",\"mtext\",null,{\"children\":\"instance\"}]]}]]}]}]}],[\"$\",\"mtd\",null,{\"children\":[\"$\",\"mstyle\",null,{\"scriptlevel\":\"0\",\"displaystyle\":\"true\",\"children\":[\"$\",\"mrow\",null,{\"children\":[[\"$\",\"mrow\",null,{}],[\"$\",\"mo\",null,{\"children\":\"+\"}],[\"$\",\"mn\",null,{\"children\":\"2\"}],[\"$\",\"mo\",null,{\"children\":\"⋅\"}],[\"$\",\"mo\",null,{\"stretchy\":\"false\",\"children\":\"(\"}],[\"$\",\"mn\",null,{\"children\":\"4\"}],[\"$\",\"mo\",null,{\"children\":\"+\"}],[\"$\",\"mn\",null,{\"children\":\"6\"}],[\"$\",\"mo\",null,{\"stretchy\":\"false\",\"children\":\")\"}],[\"$\",\"mo\",null,{\"children\":\"⋅\"}],[\"$\",\"mn\",null,{\"children\":\"0.0\"}],[\"$\",\"msub\",null,{\"children\":[[\"$\",\"mn\",null,{\"children\":\"9\"}],[\"$\",\"mtext\",null,{\"children\":\"block storage\"}]]}],[\"$\",\"mo\",null,{\"children\":\"+\"}],[\"$\",\"mn\",null,{\"children\":\"3.3\"}],[\"$\",\"msub\",null,{\"children\":[[\"$\",\"mn\",null,{\"children\":\"4\"}],[\"$\",\"mtext\",null,{\"children\":\"IP\"}]]}],[\"$\",\"mo\",null,{\"children\":\"+\"}],[\"$\",\"mn\",null,{\"children\":\"1\"}],[\"$\",\"msub\",null,{\"children\":[[\"$\",\"mn\",null,{\"children\":\"0\"}],[\"$\",\"mtext\",null,{\"children\":\"load-balancer\"}]]}]]}]}]}]]}],[\"$\",\"mtr\",null,{\"children\":[[\"$\",\"mtd\",null,{\"children\":[\"$\",\"mstyle\",null,{\"scriptlevel\":\"0\",\"displaystyle\":\"true\",\"children\":[\"$\",\"mrow\",null,{}]}]}],[\"$\",\"mtd\",null,{\"children\":[\"$\",\"mstyle\",null,{\"scriptlevel\":\"0\",\"displaystyle\":\"true\",\"children\":[\"$\",\"mrow\",null,{\"children\":[[\"$\",\"mrow\",null,{}],[\"$\",\"mo\",null,{\"children\":\"=\"}],[\"$\",\"mn\",null,{\"children\":\"26.90\"}],[\"$\",\"mtext\",null,{\"children\":\" CHF/month\"}],[\"$\",\"mo\",null,{\"children\":\"≈\"}],[\"$\",\"mn\",null,{\"children\":\"30\"}],[\"$\",\"mtext\",null,{\"children\":\" USD/month\"}]]}]}]}]]}]]}],[\"$\",\"annotation\",null,{\"encoding\":\"application/x-tex\",\"children\":\"\\\\begin{align*}\\n2\\\\cdot 5.88_\\\\text{instance} \u0026+ 2\\\\cdot(4+6)\\\\cdot0.09_\\\\text{block storage} + 3.34_\\\\text{IP} + 10_\\\\text{load-balancer}\\\\\\\\\\n\u0026= 26.90 \\\\text{ CHF/month}\\\\approx 30\\\\text{ USD/month}\\n\\\\end{align*}\"}]]}]}]}],[\"$\",\"span\",null,{\"className\":\"katex-html\",\"aria-hidden\":\"true\",\"children\":[\"$\",\"span\",null,{\"className\":\"base\",\"children\":[[\"$\",\"span\",null,{\"className\":\"strut\",\"style\":{\"height\":\"3em\",\"verticalAlign\":\"-1.25em\"}}],[\"$\",\"span\",null,{\"className\":\"mord\",\"children\":[\"$\",\"span\",null,{\"className\":\"mtable\",\"children\":[[\"$\",\"span\",null,{\"className\":\"col-align-r\",\"children\":[\"$\",\"span\",null,{\"className\":\"vlist-t vlist-t2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"vlist-r\",\"children\":[[\"$\",\"span\",null,{\"className\":\"vlist\",\"style\":{\"height\":\"1.75em\"},\"children\":[[\"$\",\"span\",null,{\"style\":{\"top\":\"-3.91em\"},\"children\":[[\"$\",\"span\",null,{\"className\":\"pstrut\",\"style\":{\"height\":\"3em\"}}],[\"$\",\"span\",null,{\"className\":\"mord\",\"children\":[[\"$\",\"span\",null,{\"className\":\"mord\",\"children\":\"2\"}],[\"$\",\"span\",null,{\"className\":\"mspace\",\"style\":{\"marginRight\":\"0.2222em\"}}],[\"$\",\"span\",null,{\"className\":\"mbin\",\"children\":\"⋅\"}],[\"$\",\"span\",null,{\"className\":\"mspace\",\"style\":{\"marginRight\":\"0.2222em\"}}],[\"$\",\"span\",null,{\"className\":\"mord\",\"children\":\"5.8\"}],[\"$\",\"span\",null,{\"className\":\"mord\",\"children\":[[\"$\",\"span\",null,{\"className\":\"mord\",\"children\":\"8\"}],[\"$\",\"span\",null,{\"className\":\"msupsub\",\"children\":[\"$\",\"span\",null,{\"className\":\"vlist-t vlist-t2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"vlist-r\",\"children\":[[\"$\",\"span\",null,{\"className\":\"vlist\",\"style\":{\"height\":\"0.3175em\"},\"children\":[\"$\",\"span\",null,{\"style\":{\"top\":\"-2.55em\",\"marginLeft\":\"0em\",\"marginRight\":\"0.05em\"},\"children\":[[\"$\",\"span\",null,{\"className\":\"pstrut\",\"style\":{\"height\":\"2.7em\"}}],[\"$\",\"span\",null,{\"className\":\"sizing reset-size6 size3 mtight\",\"children\":[\"$\",\"span\",null,{\"className\":\"mord text mtight\",\"children\":[\"$\",\"span\",null,{\"className\":\"mord mtight\",\"children\":\"instance\"}]}]}]]}]}],[\"$\",\"span\",null,{\"className\":\"vlist-s\",\"children\":\"​\"}]]}],[\"$\",\"span\",null,{\"className\":\"vlist-r\",\"children\":[\"$\",\"span\",null,{\"className\":\"vlist\",\"style\":{\"height\":\"0.15em\"},\"children\":[\"$\",\"span\",null,{}]}]}]]}]}]]}]]}]]}],[\"$\",\"span\",null,{\"style\":{\"top\":\"-2.41em\"},\"children\":[[\"$\",\"span\",null,{\"className\":\"pstrut\",\"style\":{\"height\":\"3em\"}}],[\"$\",\"span\",null,{\"className\":\"mord\"}]]}]]}],[\"$\",\"span\",null,{\"className\":\"vlist-s\",\"children\":\"​\"}]]}],[\"$\",\"span\",null,{\"className\":\"vlist-r\",\"children\":[\"$\",\"span\",null,{\"className\":\"vlist\",\"style\":{\"height\":\"1.25em\"},\"children\":[\"$\",\"span\",null,{}]}]}]]}]}],[\"$\",\"span\",null,{\"className\":\"col-align-l\",\"children\":[\"$\",\"span\",null,{\"className\":\"vlist-t vlist-t2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"vlist-r\",\"children\":[[\"$\",\"span\",null,{\"className\":\"vlist\",\"style\":{\"height\":\"1.75em\"},\"children\":[[\"$\",\"span\",null,{\"style\":{\"top\":\"-3.91em\"},\"children\":[[\"$\",\"span\",null,{\"className\":\"pstrut\",\"style\":{\"height\":\"3em\"}}],[\"$\",\"span\",null,{\"className\":\"mord\",\"children\":[[\"$\",\"span\",null,{\"className\":\"mord\"}],[\"$\",\"span\",null,{\"className\":\"mspace\",\"style\":{\"marginRight\":\"0.2222em\"}}],[\"$\",\"span\",null,{\"className\":\"mbin\",\"children\":\"+\"}],[\"$\",\"span\",null,{\"className\":\"mspace\",\"style\":{\"marginRight\":\"0.2222em\"}}],[\"$\",\"span\",null,{\"className\":\"mord\",\"children\":\"2\"}],[\"$\",\"span\",null,{\"className\":\"mspace\",\"style\":{\"marginRight\":\"0.2222em\"}}],[\"$\",\"span\",null,{\"className\":\"mbin\",\"children\":\"⋅\"}],[\"$\",\"span\",null,{\"className\":\"mspace\",\"style\":{\"marginRight\":\"0.2222em\"}}],[\"$\",\"span\",null,{\"className\":\"mopen\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"mord\",\"children\":\"4\"}],[\"$\",\"span\",null,{\"className\":\"mspace\",\"style\":{\"marginRight\":\"0.2222em\"}}],[\"$\",\"span\",null,{\"className\":\"mbin\",\"children\":\"+\"}],[\"$\",\"span\",null,{\"className\":\"mspace\",\"style\":{\"marginRight\":\"0.2222em\"}}],[\"$\",\"span\",null,{\"className\":\"mord\",\"children\":\"6\"}],[\"$\",\"span\",null,{\"className\":\"mclose\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"mspace\",\"style\":{\"marginRight\":\"0.2222em\"}}],[\"$\",\"span\",null,{\"className\":\"mbin\",\"children\":\"⋅\"}],[\"$\",\"span\",null,{\"className\":\"mspace\",\"style\":{\"marginRight\":\"0.2222em\"}}],[\"$\",\"span\",null,{\"className\":\"mord\",\"children\":\"0.0\"}],[\"$\",\"span\",null,{\"className\":\"mord\",\"children\":[[\"$\",\"span\",null,{\"className\":\"mord\",\"children\":\"9\"}],[\"$\",\"span\",null,{\"className\":\"msupsub\",\"children\":[\"$\",\"span\",null,{\"className\":\"vlist-t vlist-t2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"vlist-r\",\"children\":[[\"$\",\"span\",null,{\"className\":\"vlist\",\"style\":{\"height\":\"0.3361em\"},\"children\":[\"$\",\"span\",null,{\"style\":{\"top\":\"-2.55em\",\"marginLeft\":\"0em\",\"marginRight\":\"0.05em\"},\"children\":[[\"$\",\"span\",null,{\"className\":\"pstrut\",\"style\":{\"height\":\"2.7em\"}}],[\"$\",\"span\",null,{\"className\":\"sizing reset-size6 size3 mtight\",\"children\":[\"$\",\"span\",null,{\"className\":\"mord text mtight\",\"children\":[\"$\",\"span\",null,{\"className\":\"mord mtight\",\"children\":\"block storage\"}]}]}]]}]}],[\"$\",\"span\",null,{\"className\":\"vlist-s\",\"children\":\"​\"}]]}],[\"$\",\"span\",null,{\"className\":\"vlist-r\",\"children\":[\"$\",\"span\",null,{\"className\":\"vlist\",\"style\":{\"height\":\"0.2861em\"},\"children\":[\"$\",\"span\",null,{}]}]}]]}]}]]}],[\"$\",\"span\",null,{\"className\":\"mspace\",\"style\":{\"marginRight\":\"0.2222em\"}}],[\"$\",\"span\",null,{\"className\":\"mbin\",\"children\":\"+\"}],[\"$\",\"span\",null,{\"className\":\"mspace\",\"style\":{\"marginRight\":\"0.2222em\"}}],[\"$\",\"span\",null,{\"className\":\"mord\",\"children\":\"3.3\"}],[\"$\",\"span\",null,{\"className\":\"mord\",\"children\":[[\"$\",\"span\",null,{\"className\":\"mord\",\"children\":\"4\"}],[\"$\",\"span\",null,{\"className\":\"msupsub\",\"children\":[\"$\",\"span\",null,{\"className\":\"vlist-t vlist-t2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"vlist-r\",\"children\":[[\"$\",\"span\",null,{\"className\":\"vlist\",\"style\":{\"height\":\"0.3283em\"},\"children\":[\"$\",\"span\",null,{\"style\":{\"top\":\"-2.55em\",\"marginLeft\":\"0em\",\"marginRight\":\"0.05em\"},\"children\":[[\"$\",\"span\",null,{\"className\":\"pstrut\",\"style\":{\"height\":\"2.7em\"}}],[\"$\",\"span\",null,{\"className\":\"sizing reset-size6 size3 mtight\",\"children\":[\"$\",\"span\",null,{\"className\":\"mord text mtight\",\"children\":[\"$\",\"span\",null,{\"className\":\"mord mtight\",\"children\":\"IP\"}]}]}]]}]}],[\"$\",\"span\",null,{\"className\":\"vlist-s\",\"children\":\"​\"}]]}],[\"$\",\"span\",null,{\"className\":\"vlist-r\",\"children\":[\"$\",\"span\",null,{\"className\":\"vlist\",\"style\":{\"height\":\"0.15em\"},\"children\":[\"$\",\"span\",null,{}]}]}]]}]}]]}],[\"$\",\"span\",null,{\"className\":\"mspace\",\"style\":{\"marginRight\":\"0.2222em\"}}],[\"$\",\"span\",null,{\"className\":\"mbin\",\"children\":\"+\"}],[\"$\",\"span\",null,{\"className\":\"mspace\",\"style\":{\"marginRight\":\"0.2222em\"}}],[\"$\",\"span\",null,{\"className\":\"mord\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"mord\",\"children\":[[\"$\",\"span\",null,{\"className\":\"mord\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"msupsub\",\"children\":[\"$\",\"span\",null,{\"className\":\"vlist-t vlist-t2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"vlist-r\",\"children\":[[\"$\",\"span\",null,{\"className\":\"vlist\",\"style\":{\"height\":\"0.3361em\"},\"children\":[\"$\",\"span\",null,{\"style\":{\"top\":\"-2.55em\",\"marginLeft\":\"0em\",\"marginRight\":\"0.05em\"},\"children\":[[\"$\",\"span\",null,{\"className\":\"pstrut\",\"style\":{\"height\":\"2.7em\"}}],[\"$\",\"span\",null,{\"className\":\"sizing reset-size6 size3 mtight\",\"children\":[\"$\",\"span\",null,{\"className\":\"mord text mtight\",\"children\":[\"$\",\"span\",null,{\"className\":\"mord mtight\",\"children\":\"load-balancer\"}]}]}]]}]}],[\"$\",\"span\",null,{\"className\":\"vlist-s\",\"children\":\"​\"}]]}],[\"$\",\"span\",null,{\"className\":\"vlist-r\",\"children\":[\"$\",\"span\",null,{\"className\":\"vlist\",\"style\":{\"height\":\"0.15em\"},\"children\":[\"$\",\"span\",null,{}]}]}]]}]}]]}]]}]]}],[\"$\",\"span\",null,{\"style\":{\"top\":\"-2.41em\"},\"children\":[[\"$\",\"span\",null,{\"className\":\"pstrut\",\"style\":{\"height\":\"3em\"}}],[\"$\",\"span\",null,{\"className\":\"mord\",\"children\":[[\"$\",\"span\",null,{\"className\":\"mord\"}],[\"$\",\"span\",null,{\"className\":\"mspace\",\"style\":{\"marginRight\":\"0.2778em\"}}],[\"$\",\"span\",null,{\"className\":\"mrel\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"mspace\",\"style\":{\"marginRight\":\"0.2778em\"}}],[\"$\",\"span\",null,{\"className\":\"mord\",\"children\":\"26.90\"}],[\"$\",\"span\",null,{\"className\":\"mord text\",\"children\":[\"$\",\"span\",null,{\"className\":\"mord\",\"children\":\" CHF/month\"}]}],[\"$\",\"span\",null,{\"className\":\"mspace\",\"style\":{\"marginRight\":\"0.2778em\"}}],[\"$\",\"span\",null,{\"className\":\"mrel\",\"children\":\"≈\"}],[\"$\",\"span\",null,{\"className\":\"mspace\",\"style\":{\"marginRight\":\"0.2778em\"}}],[\"$\",\"span\",null,{\"className\":\"mord\",\"children\":\"30\"}],[\"$\",\"span\",null,{\"className\":\"mord text\",\"children\":[\"$\",\"span\",null,{\"className\":\"mord\",\"children\":\" USD/month\"}]}]]}]]}]]}],[\"$\",\"span\",null,{\"className\":\"vlist-s\",\"children\":\"​\"}]]}],[\"$\",\"span\",null,{\"className\":\"vlist-r\",\"children\":[\"$\",\"span\",null,{\"className\":\"vlist\",\"style\":{\"height\":\"1.25em\"},\"children\":[\"$\",\"span\",null,{}]}]}]]}]}]]}]}]]}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The majority of the cost comes from the network where the module uses a load-balancer which is not strictly required for single server clusters. However, this allows to keep all nodes in a private network and only expose allowed ports on the load-balancer to the outside.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"In practice, more disk space is needed for the operating system (minimum advised: 16Go) and for the RKE2 data (minimum advised: 32Go), bringing the cost closer to what OVH was offering with its managed version, yet about 25% cheaper for single server. At the same price, you get a HA setup. However, adding more nodes shows how well the pricing of Infomaniak scales compared to other alternatives.\"}],\"\\n\",[\"$\",\"table\",null,{\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"Configuration\"}],[\"$\",\"th\",null,{\"children\":\"CHF/month\"}],[\"$\",\"th\",null,{\"children\":\"USD/month\"}]]}]}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"single 2cpu/4go server with 1x4cpu/15Go agent\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"~37.—\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"~41.—\"}]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"3x2cpu/4go HA servers with 1x4cpu/15Go agent\"}],[\"$\",\"td\",null,{\"children\":\"~50.—\"}],[\"$\",\"td\",null,{\"children\":\"~56.—\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"3x2cpu/4go HA servers with 3x4cpu/15Go agents\"}],[\"$\",\"td\",null,{\"children\":\"~85.—\"}],[\"$\",\"td\",null,{\"children\":\"~95.—\"}]]}]]}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Previous versions of the module used a floating IP and the Virtual Router Redundancy Protocol (VRRP) via \",[\"$\",\"a\",null,{\"href\":\"https://github.com/acassen/keepalived\",\"children\":\"keepalived\"}],\" on the server nodes. Tweaking a bit the RKE2 config, it was possible to reach a cost of 11.— CHF/month (~12.— USD/month) with 1 cpu and 2Go of RAM for both the server and the agent. This was a cheaper solution, however the convenience of the load-balancer is worth the extra money.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Note that the load-balancer can be shared by multiple Kubernetes services using the following annotation (you can find the UUID in the Horizon dashboard):\"}],\"\\n\",[\"$\",\"div\",null,{\"data-rehype-pretty-code-fragment\":\"\",\"children\":[\"$\",\"pre\",null,{\"data-language\":\"yaml\",\"data-theme\":\"default\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"yaml\",\"data-theme\":\"default\",\"children\":[\"$\",\"span\",null,{\"className\":\"line\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"loadbalancer.openstack.org/load-balancer-id\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"uuid-of-the-load-balancer\\\"\"}]]}]}]}]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"conclusion\",\"children\":[\"$\",\"a\",null,{\"href\":\"#conclusion\",\"children\":\"Conclusion\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"As seen, setting up a Kubernetes cluster from scratch can be an interesting and cheaper alternative to using managed ones. However, it will require regular maintenance and some additional initial efforts. It offers a great way to learn and acquire practical experience with Kubernetes. If you are looking for a managed solution on Infomaniak to benefit from the great pricing, \",[\"$\",\"a\",null,{\"href\":\"https://exponent.ch\",\"children\":\"Exponent.ch\"}],\" offers a managed service on your own account.\"]}],\"\\n\",[\"$\",\"section\",null,{\"data-footnotes\":true,\"className\":\"footnotes\",\"children\":[[\"$\",\"h3\",null,{\"className\":\"sr-only\",\"id\":\"footnote-label\",\"children\":[\"$\",\"a\",null,{\"href\":\"#footnote-label\",\"children\":\"Footnotes\"}]}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"id\":\"user-content-fn-1\",\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"https://github.com/kubernetes/minikube\",\"children\":\"Minikube\"}],\" and \",[\"$\",\"a\",null,{\"href\":\"https://github.com/kubernetes-sigs/kind\",\"children\":\"kind\"}],\" offer local clusters, however it will not expose you to the reality of running a cluster on multiple nodes. \",[\"$\",\"a\",null,{\"href\":\"#user-content-fnref-1\",\"data-footnote-backref\":true,\"className\":\"data-footnote-backref\",\"aria-label\":\"Back to content\",\"children\":\"↩\"}]]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"id\":\"user-content-fn-2\",\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"In practice each agent consume some resources to run the Kubernetes components (network and node controller), so the article assumes 1Go less of RAM available and 200m less of cpu. \",[\"$\",\"a\",null,{\"href\":\"#user-content-fnref-2\",\"data-footnote-backref\":true,\"className\":\"data-footnote-backref\",\"aria-label\":\"Back to content\",\"children\":\"↩\"}]]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"id\":\"user-content-fn-3\",\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"This comes from my own experience and was acknowledged by their support in 2022. \",[\"$\",\"a\",null,{\"href\":\"#user-content-fnref-3\",\"data-footnote-backref\":true,\"className\":\"data-footnote-backref\",\"aria-label\":\"Back to content\",\"children\":\"↩\"}]]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"id\":\"user-content-fn-4\",\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The Hetzner community maintains also a great \",[\"$\",\"a\",null,{\"href\":\"https://github.com/kube-hetzner/terraform-hcloud-kube-hetzner\",\"children\":\"Terraform module\"}],\". \",[\"$\",\"a\",null,{\"href\":\"#user-content-fnref-4\",\"data-footnote-backref\":true,\"className\":\"data-footnote-backref\",\"aria-label\":\"Back to content\",\"children\":\"↩\"}]]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}]]}]\n"])</script><script>self.__next_f.push([1,"9:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"5:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Low-cost Kubernetes cluster on Infomaniak\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"How to deploy k8s on a $30.— monthly budget or less.\"}],[\"$\",\"meta\",\"3\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/icon.svg?a05afc09b4abba7d\",\"type\":\"image/svg+xml\",\"sizes\":\"260x260\"}]]\n"])</script></body></html>