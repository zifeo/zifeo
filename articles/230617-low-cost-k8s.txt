1:HL["/_next/static/media/21ed5661b47f7f6d-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
2:HL["/_next/static/css/211e56791715b88d.css","style",{"crossOrigin":""}]
0:["vbR4w0E28yQ7Oq1EgBk4q",[[["",{"children":["articles",{"children":[["article","230617-low-cost-k8s","d"],{"children":["__PAGE__?{\"article\":\"230617-low-cost-k8s\"}",{}]}]}]},"$undefined","$undefined",true],"$L3",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/211e56791715b88d.css","precedence":"next","crossOrigin":""}]],"$L4"]]]]
5:I[2073,["73","static/chunks/73-9f24fbd2986aa991.js","772","static/chunks/app/articles/%5Barticle%5D/layout-26a0baa770747653.js"],""]
6:I[1392,["97","static/chunks/97-60c0aa7414a714cf.js","355","static/chunks/app/articles/%5Barticle%5D/page-38f48cb03ddc0ae8.js"],"ExportedImage"]
7:I[825,[],""]
8:I[4348,[],""]
b:I[6433,["73","static/chunks/73-9f24fbd2986aa991.js","772","static/chunks/app/articles/%5Barticle%5D/layout-26a0baa770747653.js"],"Newsletter"]
c:I[1293,["73","static/chunks/73-9f24fbd2986aa991.js","772","static/chunks/app/articles/%5Barticle%5D/layout-26a0baa770747653.js"],"Giscus"]
3:[null,["$","html",null,{"lang":"en","children":["$","body",null,{"className":"__className_3dc409 bg-white ","children":[["$","div",null,{"className":"container my-16","children":["$","div",null,{"className":"flex gap-4 items-center","children":[["$","div",null,{"className":"grow-0","children":["$","$L5",null,{"href":"/","children":["$","$L6",null,{"src":"/images/teo.jpg","alt":"Teo's picture","width":100,"height":100,"className":"rounded-full"}]}]}],["$","div",null,{"className":"grow flex flex-col space-y-1","children":[["$","$L5",null,{"href":"/","children":["$","h1",null,{"children":"Teo Stocco"}]}],["$","p",null,{"children":"Fractional Chief of Technology at KiWi and Exponent"}],["$","nav",null,{"className":"flex gap-1 text-xs uppercase","children":[["$","ul","https://linkedin.com/in/zifeo",{"children":["$","li",null,{"children":["$","a",null,{"href":"https://linkedin.com/in/zifeo","title":"Teo's LinkedIn","children":"LinkedIn"}]}]}],["$","ul","https://github.com/zifeo",{"children":["$","li",null,{"children":["$","a",null,{"href":"https://github.com/zifeo","title":"Teo's GitHub","children":"GitHub"}]}]}],["$","ul","https://twitter.com/zifeo",{"children":["$","li",null,{"children":["$","a",null,{"href":"https://twitter.com/zifeo","title":"Teo's Twitter","children":"Twitter"}]}]}],["$","ul","https://dev.to/zifeo",{"children":["$","li",null,{"children":["$","a",null,{"href":"https://dev.to/zifeo","title":"Teo's DevTo","children":"DevTo"}]}]}]]}]]}]]}]}],["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L8",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":["$","main",null,{"children":["$","div",null,{"className":"container my-16 flex flex-col space-y-4","children":[["$","h2",null,{"children":"Not Found"}],["$","p",null,{"children":["Return to the ",["$","$L5",null,{"href":"/","children":"homepage"}],"."]}]]}]}],"notFoundStyles":[],"initialChildNode":["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children","articles","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L8",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","initialChildNode":[null,["$","main",null,{"className":"container my-16 flex flex-col space-y-8","children":[["$","div",null,{"className":"flex justify-between text-sm","children":[["$","div",null,{"className":"group","children":["$","$L5",null,{"href":"/","className":"group-hover:no-underline text-zinc-500","children":["← ",["$","span",null,{"className":"group-hover:underline text-zinc-500","children":"Back"}]]}]}],["$","div",null,{"children":["$","a",null,{"href":"https://github.com/zifeo/zifeo/edit/main/content/articles/230617-low-cost-k8s.mdx","className":"text-zinc-500","children":"Edit/improve on Github"}]}]]}],["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children","articles","children",["article","230617-low-cost-k8s","d"],"children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L8",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","initialChildNode":["$L9","$La",null],"childPropSegment":"__PAGE__?{\"article\":\"230617-low-cost-k8s\"}","styles":null}],["$","$Lb",null,{}],["$","div",null,{"className":"flex justify-between text-sm","children":[["$","div",null,{"className":"group","children":["$","$L5",null,{"href":"/","className":"group-hover:no-underline text-zinc-500","children":["← ",["$","span",null,{"className":"group-hover:underline text-zinc-500","children":"Back"}]]}]}],["$","div",null,{"children":["$","a",null,{"href":"https://github.com/zifeo/zifeo/edit/main/content/articles/230617-low-cost-k8s.mdx","className":"text-zinc-500","children":"Edit/improve on Github"}]}]]}],["$","$Lc",null,{}]]}],null],"childPropSegment":["article","230617-low-cost-k8s","d"],"styles":null}],"childPropSegment":"articles","styles":null}],["$","div",null,{"className":"container my-16","children":["$","div",null,{"className":"flex flex-col space-y-4","children":[["$","nav",null,{"className":"flex gap-1 text-xs uppercase","children":[["$","ul","https://linkedin.com/in/zifeo",{"children":["$","li",null,{"children":["$","a",null,{"href":"https://linkedin.com/in/zifeo","title":"Teo's LinkedIn","children":"LinkedIn"}]}]}],["$","ul","https://github.com/zifeo",{"children":["$","li",null,{"children":["$","a",null,{"href":"https://github.com/zifeo","title":"Teo's GitHub","children":"GitHub"}]}]}],["$","ul","https://twitter.com/zifeo",{"children":["$","li",null,{"children":["$","a",null,{"href":"https://twitter.com/zifeo","title":"Teo's Twitter","children":"Twitter"}]}]}],["$","ul","https://dev.to/zifeo",{"children":["$","li",null,{"children":["$","a",null,{"href":"https://dev.to/zifeo","title":"Teo's DevTo","children":"DevTo"}]}]}]]}],["$","p",null,{"className":"leading-5 text-sm","children":["© Teo Stocco. Texts and images are available under the"," ",["$","a",null,{"href":"https://creativecommons.org/licenses/by-sa/4.0/","title":"Attribution-ShareAlike 4.0 International license","className":"hover:text-black hover:underline underline-offset-4 decoration-2 decoration-zinc-800","children":"Creative Commons Attribution-ShareAlike 4.0 license"}],", unless stated otherwise. Website","'","s"," ",["$","a",null,{"href":"https://github.com/zifeo/zifeo","title":"Website source code on GitHub","className":"hover:text-black hover:underline underline-offset-4 decoration-2 decoration-zinc-800","children":"source code"}]," ","is available under the"," ",["$","a",null,{"href":"https://github.com/zifeo/zifeo/blob/main/LICENSE.md","title":"Mozilla Public License 2.0","className":"hover:text-black hover:underline underline-offset-4 decoration-2 decoration-zinc-800","children":"Mozilla Public License 2.0"}],"."]}]]}]}]]}]}],null]
a:["$","article",null,{"className":"flex flex-col space-y-4","children":[["$","h2",null,{"id":"low-cost-kubernetes-cluster-on-infomaniak","children":[["$","a",null,{"aria-hidden":"true","tabIndex":"-1","href":"#low-cost-kubernetes-cluster-on-infomaniak","children":["$","span",null,{"className":"icon icon-link"}]}],"Low-cost Kubernetes cluster on Infomaniak"]}],"\n",["$","p",null,{"children":[["$","a",null,{"href":"https://kubernetes.io","children":"Kubernetes"}]," (k8s) is becoming the de facto standard for container orchestration. While it provides convenient abstractions and solves many pain points, it is not as accessible as running a local copy of Docker",["$","sup",null,{"children":["$","a",null,{"href":"#user-content-fn-1","id":"user-content-fnref-1","data-footnote-ref":true,"aria-describedby":"footnote-label","children":"1"}]}],". This makes it harder to learn and get real hands-on experience without being part of a DevOps team or getting ruined quickly."]}],"\n",["$","p",null,{"children":["When looking at popular Kubernetes providers and without going into their complex pricing structure, the lowest price one can find for a managed Kubernetes is roughly $55/month for 4cpu and 15Go",["$","sup",null,{"children":["$","a",null,{"href":"#user-content-fn-2","id":"user-content-fnref-2","data-footnote-ref":true,"aria-describedby":"footnote-label","children":"2"}]}]," of RAM available (June 2023)."]}],"\n",["$","table",null,{"children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"children":"Provider"}],["$","th",null,{"children":"Region"}],["$","th",null,{"children":"Cluster fees"}],["$","th",null,{"children":"4cpu / 15Go"}],["$","th",null,{"children":"Note"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"children":"GKE"}],["$","td",null,{"children":"Frankfurt"}],["$","td",null,{"children":"$$73/month"}],["$","td",null,{"children":"$$126"}],["$","td",null,{"children":"$$74.40/month of free credit"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"AWS"}],["$","td",null,{"children":"Frankfurt"}],["$","td",null,{"children":"$$73/month"}],["$","td",null,{"children":"$$112"}],["$","td",null,{}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"AKS"}],["$","td",null,{"children":"West Germany"}],["$","td",null,{"children":"Free"}],["$","td",null,{"children":"$$112"}],["$","td",null,{"children":"$$73/month for pro cluster"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"Linode"}],["$","td",null,{"children":"Frankfurt"}],["$","td",null,{"children":"$$36"}],["$","td",null,{"children":"$$72"}],["$","td",null,{"children":"Only 8Go RAM"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"Scaleway"}],["$","td",null,{"children":"Paris"}],["$","td",null,{"children":"Free"}],["$","td",null,{"children":"$$73"}],["$","td",null,{"children":["98% API server availability",["$","sup",null,{"children":["$","a",null,{"href":"#user-content-fn-3","id":"user-content-fnref-3","data-footnote-ref":true,"aria-describedby":"footnote-label","children":"3"}]}]]}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"OVH"}],["$","td",null,{"children":"Frankfurt"}],["$","td",null,{"children":"Free"}],["$","td",null,{"children":"$$55"}],["$","td",null,{}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"Exoscale"}],["$","td",null,{"children":"Frankfurt"}],["$","td",null,{"children":"Free"}],["$","td",null,{"children":"$$136"}],["$","td",null,{"children":"$$40/month for pro cluster"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"DigitalOcean"}],["$","td",null,{"children":"Frankfurt"}],["$","td",null,{"children":"Free"}],["$","td",null,{"children":"$$126"}],["$","td",null,{"children":"$$40/month for pro cluster"}]]}]]}]]}],"\n",["$","p",null,{"children":["At that price, it becomes interesting to look at reasonably priced VMs providers like Hetzner or Infomaniak, and install Kubernetes directly on it. This comes at the cost of managing the cluster ourselves and maintaining it over time. While this offers a good learning opportunity, it may also be a source of frustration as the setup can be non-trivial. For this reason, the ",["$","a",null,{"href":"https://docs.rke2.io","children":"RKE2"}]," distribution of Kubernetes is a great pick as it offers a good balance between features, security and simplicity."]}],"\n",["$","p",null,{"children":["Regarding the hardware provider, Infomaniak offers currently better price than Hetzner",["$","sup",null,{"children":["$","a",null,{"href":"#user-content-fn-4","id":"user-content-fnref-4","data-footnote-ref":true,"aria-describedby":"footnote-label","children":"4"}]}]," and especially gives us with direct access to OpenStack, a well-known open source platform to provision infrastructure (also offered by OVH). This makes it easier to manage the resources using code (IaC) and comes with a good support for Terraform."]}],"\n",["$","h3",null,{"id":"getting-started","children":[["$","a",null,{"aria-hidden":"true","tabIndex":"-1","href":"#getting-started","children":["$","span",null,{"className":"icon icon-link"}]}],"Getting started"]}],"\n",["$","p",null,{"children":["You will need an ",["$","a",null,{"href":"https://welcome.infomaniak.com/signup","children":"account on Infomaniak"}],", a valid credit card and ",["$","a",null,{"href":"https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli","children":"Terraform installed"}],"."]}],"\n",["$","p",null,{"children":["Once you have your Infomaniak account, go on the ",["$","a",null,{"href":"https://www.infomaniak.com/fr/hebergement/public-cloud","children":"Public Cloud landing page"}]," and click on \"get started\". Pick a name for your public cloud and enter your credit card details in the checkout page. You will be charged at the end of the month for the resources you used. Note that as of the time of writing this article, Infomaniak offers up to CHF 300.— of free credit during the first 3 months."]}],"\n",["$","img",null,{"src":"230617-low-cost-k8s/public-cloud-creation.png","width":"300","class":"mx-auto","alt":"Creating a Public Cloud"}],"\n",["$","p",null,{"children":"You should then see an empty list of OpenStack project (also called tenant in the OpenStack jargon). Click on the \"create a project\" on the top right, choose a project name and a password for the autogenerated user and click on \"create\". After a few seconds, you should be redirected to the list of projects and see your newly created project."}],"\n",["$","img",null,{"src":"230617-low-cost-k8s/public-cloud-projects-list.png","width":"800","class":"mx-auto","alt":"List of OpenStack projects"}],"\n",["$","p",null,{"children":["You can then click on the project name, and you will be directed on ",["$","a",null,{"href":"https://api.pub1.infomaniak.cloud/horizon/auth/login/","children":"Horizon"}],", the user interface of OpenStack which is useful to follow the progress of the cluster creation."]}],"\n",["$","img",null,{"src":"230617-low-cost-k8s/horizon-welcome.png","width":"800","height":"300","class":"mx-auto"}],"\n",["$","h3",null,{"id":"terraform-openstack-rke2-module","children":[["$","a",null,{"aria-hidden":"true","tabIndex":"-1","href":"#terraform-openstack-rke2-module","children":["$","span",null,{"className":"icon icon-link"}]}],"Terraform OpenStack RKE2 module"]}],"\n",["$","p",null,{"children":["Now, you are jumping into the interesting part. You will use ",["$","a",null,{"href":"https://registry.terraform.io/modules/zifeo/rke2/openstack/latest","children":"the Terraform OpenStack RKE2 module"}]," that takes care of the heavy lifting and deploy a RKE2 cluster on OpenStack for you. Create a new directory and open a ",["$","code",null,{"children":"main.tf"}]," file with the following content:"]}],"\n",["$","div",null,{"data-rehype-pretty-code-fragment":"","children":["$","pre",null,{"className":"github-light","style":{"backgroundColor":"#fff"},"tabIndex":"0","data-language":"hcl","data-theme":"default","children":["$","code",null,{"data-language":"hcl","data-theme":"default","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#6F42C1"},"children":"variable"}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#005CC5"},"children":"\"project\""}],["$","span",null,{"style":{"color":"#24292E"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  type"}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"string"}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"}"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#6F42C1"},"children":"variable"}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#005CC5"},"children":"\"username\""}],["$","span",null,{"style":{"color":"#24292E"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  type"}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"string"}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"}"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#6F42C1"},"children":"variable"}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#005CC5"},"children":"\"password\""}],["$","span",null,{"style":{"color":"#24292E"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  type"}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"string"}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"}"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# authenticate with OpenStack"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#6F42C1"},"children":"provider"}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#005CC5"},"children":"\"openstack\""}],["$","span",null,{"style":{"color":"#24292E"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  tenant_name"}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#24292E"},"children":"var"}],["$","span",null,{"style":{"color":"#D73A49"},"children":"."}],["$","span",null,{"style":{"color":"#24292E"},"children":"project"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  user_name"}],["$","span",null,{"style":{"color":"#E36209"},"children":"   "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#24292E"},"children":"var"}],["$","span",null,{"style":{"color":"#D73A49"},"children":"."}],["$","span",null,{"style":{"color":"#24292E"},"children":"username"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  password"}],["$","span",null,{"style":{"color":"#E36209"},"children":"    "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#24292E"},"children":"var"}],["$","span",null,{"style":{"color":"#D73A49"},"children":"."}],["$","span",null,{"style":{"color":"#24292E"},"children":"password"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  auth_url"}],["$","span",null,{"style":{"color":"#E36209"},"children":"    "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"https://api.pub1.infomaniak.cloud/identity\""}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  region"}],["$","span",null,{"style":{"color":"#E36209"},"children":"      "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"dc3-a\""}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"}"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# dependency management"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#6F42C1"},"children":"terraform"}],["$","span",null,{"style":{"color":"#24292E"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  required_version"}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"\">= 0.14.0\""}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"required_providers"}],["$","span",null,{"style":{"color":"#24292E"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"    openstack"}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#24292E"},"children":"{"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"      source  "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"terraform-provider-openstack/openstack\""}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"      version "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"\">= 1.49.0\""}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"    }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"}"}]}]]}]}]}],"\n",["$","p",null,{"children":["This creates 3 variables that will be used to authenticate to the OpenStack API and configure the OpenStack provider and ensure that the latter is using the expected version. If you would like to avoid having to enter your credentials each time, you can create a ",["$","code",null,{"children":"terraform.tfvars"}]," (make sure to add this file to your ",["$","code",null,{"children":"gitignore"}]," and never accidentally share that file) or check the alternative ",["$","a",null,{"href":"https://registry.terraform.io/providers/terraform-provider-openstack/openstack/latest/docs#configuration-reference","children":"authentication methods"}]," of the provider (e.g. ",["$","code",null,{"children":"cloud"}]," with ",["$","code",null,{"children":"clouds.yaml"}],"):"]}],"\n",["$","div",null,{"data-rehype-pretty-code-fragment":"","children":["$","pre",null,{"className":"github-light","style":{"backgroundColor":"#fff"},"tabIndex":"0","data-language":"yaml","data-theme":"default","children":["$","code",null,{"data-language":"yaml","data-theme":"default","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#032F62"},"children":"project=PCP-XXXXXXXX"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#032F62"},"children":"username=PCU-XXXXXXXX"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#032F62"},"children":"password=XXXXXXXX"}]}]]}]}]}],"\n",["$","p",null,{"children":["You will now declare a cluster with 1 server and 1 agent nodes in ",["$","code",null,{"children":"main.tf"}],":"]}],"\n",["$","div",null,{"data-rehype-pretty-code-fragment":"","children":["$","pre",null,{"className":"github-light","style":{"backgroundColor":"#fff"},"tabIndex":"0","data-language":"hcl","data-theme":"default","children":["$","code",null,{"data-language":"hcl","data-theme":"default","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#6F42C1"},"children":"module"}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#005CC5"},"children":"\"rke2\""}],["$","span",null,{"style":{"color":"#24292E"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  source"}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"zifeo/rke2/openstack\""}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  "}],["$","span",null,{"style":{"color":"#6A737D"},"children":"# fixing the version is recommended (follows semantic versioning)"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  "}],["$","span",null,{"style":{"color":"#6A737D"},"children":"# version = \"2.0.5\""}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  "}],["$","span",null,{"style":{"color":"#6A737D"},"children":"# must be true for single server cluster or"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  "}],["$","span",null,{"style":{"color":"#6A737D"},"children":"# only on the first run for high-availability cluster"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  bootstrap"}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#005CC5"},"children":"true"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  name"}],["$","span",null,{"style":{"color":"#E36209"},"children":"      "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"single-server\""}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  "}],["$","span",null,{"style":{"color":"#6A737D"},"children":"# path to your public key, in order to connect to the instances"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  ssh_authorized_keys"}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#24292E"},"children":"["}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"~/.ssh/id_rsa.pub\""}],["$","span",null,{"style":{"color":"#24292E"},"children":"]"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  "}],["$","span",null,{"style":{"color":"#6A737D"},"children":"# name of the public OpenStack network to use for the server IP"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  floating_pool"}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"ext-floating1\""}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  "}],["$","span",null,{"style":{"color":"#6A737D"},"children":"# allow access from any IP"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  "}],["$","span",null,{"style":{"color":"#6A737D"},"children":"# it should ideally be restricted to a secure bastion"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  rules_ssh_cidr"}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"0.0.0.0/0\""}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  rules_k8s_cidr"}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"0.0.0.0/0\""}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  "}],["$","span",null,{"style":{"color":"#6A737D"},"children":"# servers hosts Kubernetes control plane + etcd"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  "}],["$","span",null,{"style":{"color":"#6A737D"},"children":"# and are the only ones exposed to the internet"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  servers"}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#24292E"},"children":"[{"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"    name "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"server\""}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"    "}],["$","span",null,{"style":{"color":"#6A737D"},"children":"# 2 cpu and 4Go of RAM is the minimum recommended per server"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"    flavor_name "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"a2-ram4-disk0\""}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"    image_name  "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"Ubuntu 22.04 LTS Jammy Jellyfish\""}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"    system_user "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"ubuntu\""}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"    "}],["$","span",null,{"style":{"color":"#6A737D"},"children":"# size of the operating system disk"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"    boot_volume_size "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#005CC5"},"children":"4"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"    "}],["$","span",null,{"style":{"color":"#6A737D"},"children":"# size of the volume for the RKE2 data (persisted on single-server)"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"    rke2_volume_size "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#005CC5"},"children":"8"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"    rke2_version     "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"v1.26.4+rke2r1\""}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  }]"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  "}],["$","span",null,{"style":{"color":"#6A737D"},"children":"# agents runs your workloads"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  "}],["$","span",null,{"style":{"color":"#6A737D"},"children":"# and are not exposed to the internet (doable with a load balancer)"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  agents"}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#24292E"},"children":"["}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"    {"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"      name        "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"agent-a\""}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"      nodes_count "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#005CC5"},"children":"1"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"      "}],["$","span",null,{"style":{"color":"#6A737D"},"children":"# a2-ram4-disk0 is the minimal meaningful config for agents"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"      "}],["$","span",null,{"style":{"color":"#6A737D"},"children":"# you can also directly go for a4-ram16-disk0 as in the intro"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"      flavor_name "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"a2-ram4-disk0\""}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"      image_name  "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"Ubuntu 22.04 LTS Jammy Jellyfish\""}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"      system_user "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"ubuntu\""}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"      boot_volume_size "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#005CC5"},"children":"4"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"      rke2_volume_size "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#005CC5"},"children":"8"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"      rke2_version     "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"v1.26.4+rke2r1\""}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"    }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  ]"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  "}],["$","span",null,{"style":{"color":"#6A737D"},"children":"# enable automatically agent removal of the cluster"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  ff_autoremove_agent"}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#005CC5"},"children":"true"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  "}],["$","span",null,{"style":{"color":"#6A737D"},"children":"# output the kubeconfig to the current directory"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  ff_write_kubeconfig"}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#005CC5"},"children":"true"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  identity_endpoint"}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#E36209"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"https://api.pub1.infomaniak.cloud/identity\""}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"}"}]}]]}]}]}],"\n",["$","p",null,{"children":"And you are ready to go! Run the following commands and wait a few minutes for the cluster to be created (a few more are required to have all the pods running after the core is ready):"}],"\n",["$","div",null,{"data-rehype-pretty-code-fragment":"","children":["$","pre",null,{"className":"github-light","style":{"backgroundColor":"#fff"},"tabIndex":"0","data-language":"bash","data-theme":"default","children":["$","code",null,{"data-language":"bash","data-theme":"default","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#6F42C1"},"children":"terraform"}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"init"}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# ..."}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# Terraform has been successfully initialized!"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# ..."}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#6F42C1"},"children":"terraform"}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"apply"}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# ..."}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# Plan: 71 to add, 0 to change, 0 to destroy."}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"#"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# Do you want to perform these actions?"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"#   Terraform will perform the actions described above."}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"#   Only 'yes' will be accepted to approve."}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"#"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"#   Enter a value: yes"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# ..."}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# Apply complete! Resources: 71 added, 0 changed, 0 destroyed."}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#6F42C1"},"children":"cat"}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"single-server.rke2.yaml"}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# apiVersion: v1"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kind: config"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# ..."}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"export"}],["$","span",null,{"style":{"color":"#24292E"},"children":" KUBECONFIG"}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#032F62"},"children":"single-server.rke2.yaml"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#6F42C1"},"children":"kubectl"}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"get"}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"pods"}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#005CC5"},"children":"--all-namespaces"}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# NAMESPACE     NAME                                                    READY   STATUS              RESTARTS   AGE"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   helm-install-openstack-cinder-csi-2rp9z                 0/1     Pending             0          2s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   helm-install-openstack-cloud-controller-manager-4wdzt   0/1     ContainerCreating   0          2s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   helm-install-rke2-cilium-s5skd                          0/1     ContainerCreating   0          2s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   helm-install-rke2-coredns-kc4ld                         0/1     ContainerCreating   0          2s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   helm-install-rke2-metrics-server-ttt84                  0/1     Pending             0          2s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   helm-install-rke2-snapshot-controller-crd-2sdzt         0/1     Pending             0          2s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   helm-install-rke2-snapshot-controller-xqzsk             0/1     Pending             0          2s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   helm-install-rke2-snapshot-validation-webhook-5w9lw     0/1     Pending             0          2s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   helm-install-velero-4zhq7                               0/1     Pending             0          2s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   kube-apiserver-single-server-server-1                   1/1     Running             0          12s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   kube-controller-manager-single-server-server-1          1/1     Running             0          16s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   kube-scheduler-single-server-server-1                   1/1     Running             0          15s"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#6F42C1"},"children":"kubectl"}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"get"}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#032F62"},"children":"pods"}],["$","span",null,{"style":{"color":"#24292E"},"children":" "}],["$","span",null,{"style":{"color":"#005CC5"},"children":"--all-namespaces"}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# NAMESPACE     NAME                                                    READY   STATUS      RESTARTS   AGE"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   cilium-ngcrp                                            1/1     Running     0          2m39s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   cilium-operator-b947b9d8d-zc92l                         1/1     Running     0          2m39s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   cilium-qt7vr                                            1/1     Running     0          2m39s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   etcd-single-server-server-1                             1/1     Running     0          2m42s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   helm-install-openstack-cinder-csi-2rp9z                 0/1     Completed   0          2m52s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   helm-install-openstack-cloud-controller-manager-4wdzt   0/1     Completed   0          2m52s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   helm-install-rke2-cilium-s5skd                          0/1     Completed   0          2m52s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   helm-install-rke2-coredns-kc4ld                         0/1     Completed   0          2m52s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   helm-install-rke2-metrics-server-ttt84                  0/1     Completed   0          2m52s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   helm-install-rke2-snapshot-controller-crd-2sdzt         0/1     Completed   0          2m52s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   helm-install-rke2-snapshot-controller-xqzsk             0/1     Completed   0          2m52s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   helm-install-rke2-snapshot-validation-webhook-5w9lw     0/1     Completed   0          2m52s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   helm-install-velero-4zhq7                               0/1     Completed   0          2m52s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   kube-apiserver-single-server-server-1                   1/1     Running     0          3m2s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   kube-controller-manager-single-server-server-1          1/1     Running     0          3m6s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   kube-scheduler-single-server-server-1                   1/1     Running     0          3m5s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   openstack-cinder-csi-controllerplugin-cf5f9869d-xbmtv   6/6     Running     0          2m39s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   openstack-cinder-csi-nodeplugin-zghjj                   3/3     Running     0          98s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   openstack-cloud-controller-manager-bffxb                1/1     Running     0          2m19s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   rke2-coredns-rke2-coredns-autoscaler-597fb897d7-p8k7j   1/1     Running     0          2m41s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   rke2-coredns-rke2-coredns-f6f4ff467-6lrgl               1/1     Running     0          83s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   rke2-coredns-rke2-coredns-f6f4ff467-shlrv               1/1     Running     0          2m41s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   rke2-metrics-server-67d6554d69-8vhrt                    1/1     Running     0          78s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   rke2-snapshot-controller-6b9c678c77-2txzn               1/1     Running     0          77s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# kube-system   rke2-snapshot-validation-webhook-6c9d7f868c-qnqdq       1/1     Running     0          77s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# velero        restic-g8mvb                                            1/1     Running     0          30s"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"# velero        velero-5b67659997-67zgd                                 1/1     Running     0          30s"}]}]]}]}]}],"\n",["$","p",null,{"children":"You can also explore your cluster using Horizon (see instances and components of the network)."}],"\n",["$","img",null,{"src":"230617-low-cost-k8s/horizon-instances.png","width":"800","class":"mx-auto","alt":"List of instances"}],"\n",["$","p",null,{"children":["Congratulations, you just have installed your first Kubernetes cluster with RKE2! You can find more information about the module and its features (etcd backups, upgrades, volume snapshots, etc.) on the ",["$","a",null,{"href":"https://github.com/zifeo/terraform-openstack-rke2","children":"repository"}],". Give a star ⭐️ if you like it or raise an issue there if you find a bug 🐛."]}],"\n",["$","h3",null,{"id":"cluster-architecture","children":[["$","a",null,{"aria-hidden":"true","tabIndex":"-1","href":"#cluster-architecture","children":["$","span",null,{"className":"icon icon-link"}]}],"Cluster architecture"]}],"\n",["$","p",null,{"children":["The cluster is composed of 2 subnets inside a private network only reachable by the load-balancer. Many security rules control the traffic between the servers and the agents. You can add more using the ",["$","code",null,{"children":"rules_server_server"}],", ",["$","code",null,{"children":"rules_server_agent"}]," or ",["$","code",null,{"children":"rules_agent_server"}]," parameters. The load-balancer exposes by default only an SSH endpoint and the Kubernetes API server from the server nodes. These can be closed with the ",["$","code",null,{"children":"rules_ssh_cidr"}]," and ",["$","code",null,{"children":"rules_k8s_cidr"}]," parameters."]}],"\n",["$","img",null,{"src":"230617-low-cost-k8s/architecture.drawio.svg","width":"350","class":"mx-auto","alt":"Cluster architecture"}],"\n",["$","p",null,{"children":"For high-availablity (HA) setup, you will need a minimum of 3 server nodes. You can add more nodes and they will automatically join the cluster when ready (do not forget to remove the bootstrap flag for that)."}],"\n",["$","h3",null,{"id":"cost-projections","children":[["$","a",null,{"aria-hidden":"true","tabIndex":"-1","href":"#cost-projections","children":["$","span",null,{"className":"icon icon-link"}]}],"Cost projections"]}],"\n",["$","span",null,{"className":"katex-display","children":["$","span",null,{"className":"katex","children":[["$","span",null,{"className":"katex-mathml","children":["$","math",null,{"xmlns":"http://www.w3.org/1998/Math/MathML","display":"block","children":["$","semantics",null,{"children":[["$","mtable",null,{"rowspacing":"0.25em","columnalign":"right left","columnspacing":"0em","children":[["$","mtr",null,{"children":[["$","mtd",null,{"children":["$","mstyle",null,{"scriptlevel":"0","displaystyle":"true","children":["$","mrow",null,{"children":[["$","mn",null,{"children":"2"}],["$","mo",null,{"children":"⋅"}],["$","mn",null,{"children":"5.8"}],["$","msub",null,{"children":[["$","mn",null,{"children":"8"}],["$","mtext",null,{"children":"instance"}]]}]]}]}]}],["$","mtd",null,{"children":["$","mstyle",null,{"scriptlevel":"0","displaystyle":"true","children":["$","mrow",null,{"children":[["$","mrow",null,{}],["$","mo",null,{"children":"+"}],["$","mn",null,{"children":"2"}],["$","mo",null,{"children":"⋅"}],["$","mo",null,{"stretchy":"false","children":"("}],["$","mn",null,{"children":"4"}],["$","mo",null,{"children":"+"}],["$","mn",null,{"children":"6"}],["$","mo",null,{"stretchy":"false","children":")"}],["$","mo",null,{"children":"⋅"}],["$","mn",null,{"children":"0.0"}],["$","msub",null,{"children":[["$","mn",null,{"children":"9"}],["$","mtext",null,{"children":"block storage"}]]}],["$","mo",null,{"children":"+"}],["$","mn",null,{"children":"3.3"}],["$","msub",null,{"children":[["$","mn",null,{"children":"4"}],["$","mtext",null,{"children":"IP"}]]}],["$","mo",null,{"children":"+"}],["$","mn",null,{"children":"1"}],["$","msub",null,{"children":[["$","mn",null,{"children":"0"}],["$","mtext",null,{"children":"load-balancer"}]]}]]}]}]}]]}],["$","mtr",null,{"children":[["$","mtd",null,{"children":["$","mstyle",null,{"scriptlevel":"0","displaystyle":"true","children":["$","mrow",null,{}]}]}],["$","mtd",null,{"children":["$","mstyle",null,{"scriptlevel":"0","displaystyle":"true","children":["$","mrow",null,{"children":[["$","mrow",null,{}],["$","mo",null,{"children":"="}],["$","mn",null,{"children":"26.90"}],["$","mtext",null,{"children":" CHF/month"}],["$","mo",null,{"children":"≈"}],["$","mn",null,{"children":"30"}],["$","mtext",null,{"children":" USD/month"}]]}]}]}]]}]]}],["$","annotation",null,{"encoding":"application/x-tex","children":"\\begin{align*}\n2\\cdot 5.88_\\text{instance} &+ 2\\cdot(4+6)\\cdot0.09_\\text{block storage} + 3.34_\\text{IP} + 10_\\text{load-balancer}\\\\\n&= 26.90 \\text{ CHF/month}\\approx 30\\text{ USD/month}\n\\end{align*}"}]]}]}]}],["$","span",null,{"className":"katex-html","aria-hidden":"true","children":["$","span",null,{"className":"base","children":[["$","span",null,{"className":"strut","style":{"height":"3em","verticalAlign":"-1.25em"}}],["$","span",null,{"className":"mord","children":["$","span",null,{"className":"mtable","children":[["$","span",null,{"className":"col-align-r","children":["$","span",null,{"className":"vlist-t vlist-t2","children":[["$","span",null,{"className":"vlist-r","children":[["$","span",null,{"className":"vlist","style":{"height":"1.75em"},"children":[["$","span",null,{"style":{"top":"-3.91em"},"children":[["$","span",null,{"className":"pstrut","style":{"height":"3em"}}],["$","span",null,{"className":"mord","children":[["$","span",null,{"className":"mord","children":"2"}],["$","span",null,{"className":"mspace","style":{"marginRight":"0.2222em"}}],["$","span",null,{"className":"mbin","children":"⋅"}],["$","span",null,{"className":"mspace","style":{"marginRight":"0.2222em"}}],["$","span",null,{"className":"mord","children":"5.8"}],["$","span",null,{"className":"mord","children":[["$","span",null,{"className":"mord","children":"8"}],["$","span",null,{"className":"msupsub","children":["$","span",null,{"className":"vlist-t vlist-t2","children":[["$","span",null,{"className":"vlist-r","children":[["$","span",null,{"className":"vlist","style":{"height":"0.3175em"},"children":["$","span",null,{"style":{"top":"-2.55em","marginLeft":"0em","marginRight":"0.05em"},"children":[["$","span",null,{"className":"pstrut","style":{"height":"2.7em"}}],["$","span",null,{"className":"sizing reset-size6 size3 mtight","children":["$","span",null,{"className":"mord text mtight","children":["$","span",null,{"className":"mord mtight","children":"instance"}]}]}]]}]}],["$","span",null,{"className":"vlist-s","children":"​"}]]}],["$","span",null,{"className":"vlist-r","children":["$","span",null,{"className":"vlist","style":{"height":"0.15em"},"children":["$","span",null,{}]}]}]]}]}]]}]]}]]}],["$","span",null,{"style":{"top":"-2.41em"},"children":[["$","span",null,{"className":"pstrut","style":{"height":"3em"}}],["$","span",null,{"className":"mord"}]]}]]}],["$","span",null,{"className":"vlist-s","children":"​"}]]}],["$","span",null,{"className":"vlist-r","children":["$","span",null,{"className":"vlist","style":{"height":"1.25em"},"children":["$","span",null,{}]}]}]]}]}],["$","span",null,{"className":"col-align-l","children":["$","span",null,{"className":"vlist-t vlist-t2","children":[["$","span",null,{"className":"vlist-r","children":[["$","span",null,{"className":"vlist","style":{"height":"1.75em"},"children":[["$","span",null,{"style":{"top":"-3.91em"},"children":[["$","span",null,{"className":"pstrut","style":{"height":"3em"}}],["$","span",null,{"className":"mord","children":[["$","span",null,{"className":"mord"}],["$","span",null,{"className":"mspace","style":{"marginRight":"0.2222em"}}],["$","span",null,{"className":"mbin","children":"+"}],["$","span",null,{"className":"mspace","style":{"marginRight":"0.2222em"}}],["$","span",null,{"className":"mord","children":"2"}],["$","span",null,{"className":"mspace","style":{"marginRight":"0.2222em"}}],["$","span",null,{"className":"mbin","children":"⋅"}],["$","span",null,{"className":"mspace","style":{"marginRight":"0.2222em"}}],["$","span",null,{"className":"mopen","children":"("}],["$","span",null,{"className":"mord","children":"4"}],["$","span",null,{"className":"mspace","style":{"marginRight":"0.2222em"}}],["$","span",null,{"className":"mbin","children":"+"}],["$","span",null,{"className":"mspace","style":{"marginRight":"0.2222em"}}],["$","span",null,{"className":"mord","children":"6"}],["$","span",null,{"className":"mclose","children":")"}],["$","span",null,{"className":"mspace","style":{"marginRight":"0.2222em"}}],["$","span",null,{"className":"mbin","children":"⋅"}],["$","span",null,{"className":"mspace","style":{"marginRight":"0.2222em"}}],["$","span",null,{"className":"mord","children":"0.0"}],["$","span",null,{"className":"mord","children":[["$","span",null,{"className":"mord","children":"9"}],["$","span",null,{"className":"msupsub","children":["$","span",null,{"className":"vlist-t vlist-t2","children":[["$","span",null,{"className":"vlist-r","children":[["$","span",null,{"className":"vlist","style":{"height":"0.3361em"},"children":["$","span",null,{"style":{"top":"-2.55em","marginLeft":"0em","marginRight":"0.05em"},"children":[["$","span",null,{"className":"pstrut","style":{"height":"2.7em"}}],["$","span",null,{"className":"sizing reset-size6 size3 mtight","children":["$","span",null,{"className":"mord text mtight","children":["$","span",null,{"className":"mord mtight","children":"block storage"}]}]}]]}]}],["$","span",null,{"className":"vlist-s","children":"​"}]]}],["$","span",null,{"className":"vlist-r","children":["$","span",null,{"className":"vlist","style":{"height":"0.2861em"},"children":["$","span",null,{}]}]}]]}]}]]}],["$","span",null,{"className":"mspace","style":{"marginRight":"0.2222em"}}],["$","span",null,{"className":"mbin","children":"+"}],["$","span",null,{"className":"mspace","style":{"marginRight":"0.2222em"}}],["$","span",null,{"className":"mord","children":"3.3"}],["$","span",null,{"className":"mord","children":[["$","span",null,{"className":"mord","children":"4"}],["$","span",null,{"className":"msupsub","children":["$","span",null,{"className":"vlist-t vlist-t2","children":[["$","span",null,{"className":"vlist-r","children":[["$","span",null,{"className":"vlist","style":{"height":"0.3283em"},"children":["$","span",null,{"style":{"top":"-2.55em","marginLeft":"0em","marginRight":"0.05em"},"children":[["$","span",null,{"className":"pstrut","style":{"height":"2.7em"}}],["$","span",null,{"className":"sizing reset-size6 size3 mtight","children":["$","span",null,{"className":"mord text mtight","children":["$","span",null,{"className":"mord mtight","children":"IP"}]}]}]]}]}],["$","span",null,{"className":"vlist-s","children":"​"}]]}],["$","span",null,{"className":"vlist-r","children":["$","span",null,{"className":"vlist","style":{"height":"0.15em"},"children":["$","span",null,{}]}]}]]}]}]]}],["$","span",null,{"className":"mspace","style":{"marginRight":"0.2222em"}}],["$","span",null,{"className":"mbin","children":"+"}],["$","span",null,{"className":"mspace","style":{"marginRight":"0.2222em"}}],["$","span",null,{"className":"mord","children":"1"}],["$","span",null,{"className":"mord","children":[["$","span",null,{"className":"mord","children":"0"}],["$","span",null,{"className":"msupsub","children":["$","span",null,{"className":"vlist-t vlist-t2","children":[["$","span",null,{"className":"vlist-r","children":[["$","span",null,{"className":"vlist","style":{"height":"0.3361em"},"children":["$","span",null,{"style":{"top":"-2.55em","marginLeft":"0em","marginRight":"0.05em"},"children":[["$","span",null,{"className":"pstrut","style":{"height":"2.7em"}}],["$","span",null,{"className":"sizing reset-size6 size3 mtight","children":["$","span",null,{"className":"mord text mtight","children":["$","span",null,{"className":"mord mtight","children":"load-balancer"}]}]}]]}]}],["$","span",null,{"className":"vlist-s","children":"​"}]]}],["$","span",null,{"className":"vlist-r","children":["$","span",null,{"className":"vlist","style":{"height":"0.15em"},"children":["$","span",null,{}]}]}]]}]}]]}]]}]]}],["$","span",null,{"style":{"top":"-2.41em"},"children":[["$","span",null,{"className":"pstrut","style":{"height":"3em"}}],["$","span",null,{"className":"mord","children":[["$","span",null,{"className":"mord"}],["$","span",null,{"className":"mspace","style":{"marginRight":"0.2778em"}}],["$","span",null,{"className":"mrel","children":"="}],["$","span",null,{"className":"mspace","style":{"marginRight":"0.2778em"}}],["$","span",null,{"className":"mord","children":"26.90"}],["$","span",null,{"className":"mord text","children":["$","span",null,{"className":"mord","children":" CHF/month"}]}],["$","span",null,{"className":"mspace","style":{"marginRight":"0.2778em"}}],["$","span",null,{"className":"mrel","children":"≈"}],["$","span",null,{"className":"mspace","style":{"marginRight":"0.2778em"}}],["$","span",null,{"className":"mord","children":"30"}],["$","span",null,{"className":"mord text","children":["$","span",null,{"className":"mord","children":" USD/month"}]}]]}]]}]]}],["$","span",null,{"className":"vlist-s","children":"​"}]]}],["$","span",null,{"className":"vlist-r","children":["$","span",null,{"className":"vlist","style":{"height":"1.25em"},"children":["$","span",null,{}]}]}]]}]}]]}]}]]}]}]]}]}],"\n",["$","p",null,{"children":"The majority of the cost comes from the network where the module uses a load-balancer which is not strictly required for single server clusters. However, this allows to keep all nodes in a private network and only expose allowed ports on the load-balancer to the outside."}],"\n",["$","p",null,{"children":"In practice, more disk space is needed for the operating system (minimum advised: 16Go) and for the RKE2 data (minimum advised: 32Go), bringing the cost closer to what OVH was offering with its managed version, yet about 25% cheaper for single server. At the same price, you get a HA setup. However, adding more nodes shows how well the pricing of Infomaniak scales compared to other alternatives."}],"\n",["$","table",null,{"children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"children":"Configuration"}],["$","th",null,{"children":"CHF/month"}],["$","th",null,{"children":"USD/month"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"children":["$","strong",null,{"children":"single 2cpu/4go server with 1x4cpu/15Go agent"}]}],["$","td",null,{"children":["$","strong",null,{"children":"~37.—"}]}],["$","td",null,{"children":["$","strong",null,{"children":"~41.—"}]}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"3x2cpu/4go HA servers with 1x4cpu/15Go agent"}],["$","td",null,{"children":"~50.—"}],["$","td",null,{"children":"~56.—"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"3x2cpu/4go HA servers with 3x4cpu/15Go agents"}],["$","td",null,{"children":"~85.—"}],["$","td",null,{"children":"~95.—"}]]}]]}]]}],"\n",["$","p",null,{"children":["Previous versions of the module used a floating IP and the Virtual Router Redundancy Protocol (VRRP) via ",["$","a",null,{"href":"https://github.com/acassen/keepalived","children":"keepalived"}]," on the server nodes. Tweaking a bit the RKE2 config, it was possible to reach a cost of 11.— CHF/month (~12.— USD/month) with 1 cpu and 2Go of RAM for both the server and the agent. This was a cheaper solution, however the convenience of the load-balancer is worth the extra money."]}],"\n",["$","p",null,{"children":"Note that the load-balancer can be shared by multiple Kubernetes services using the following annotation (you can find the UUID in the Horizon dashboard):"}],"\n",["$","div",null,{"data-rehype-pretty-code-fragment":"","children":["$","pre",null,{"className":"github-light","style":{"backgroundColor":"#fff"},"tabIndex":"0","data-language":"yaml","data-theme":"default","children":["$","code",null,{"data-language":"yaml","data-theme":"default","style":{"display":"grid"},"children":["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#22863A"},"children":"loadbalancer.openstack.org/load-balancer-id"}],["$","span",null,{"style":{"color":"#24292E"},"children":": "}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"uuid-of-the-load-balancer\""}]]}]}]}]}],"\n",["$","h3",null,{"id":"conclusion","children":[["$","a",null,{"aria-hidden":"true","tabIndex":"-1","href":"#conclusion","children":["$","span",null,{"className":"icon icon-link"}]}],"Conclusion"]}],"\n",["$","p",null,{"children":["As seen, setting up a Kubernetes cluster from scratch can be an interesting and cheaper alternative to using managed ones. However, it will require regular maintenance and some additional initial efforts. It offers a great way to learn and acquire practical experience with Kubernetes. If you are looking for a managed solution on Infomaniak to benefit from the great pricing, ",["$","a",null,{"href":"https://exponent.ch","children":"Exponent.ch"}]," offers a managed service on your own account."]}],"\n",["$","section",null,{"data-footnotes":true,"className":"footnotes","children":[["$","h3",null,{"className":"sr-only","id":"footnote-label","children":[["$","a",null,{"aria-hidden":"true","tabIndex":"-1","href":"#footnote-label","children":["$","span",null,{"className":"icon icon-link"}]}],"Footnotes"]}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"id":"user-content-fn-1","children":["\n",["$","p",null,{"children":[["$","a",null,{"href":"https://github.com/kubernetes/minikube","children":"Minikube"}]," and ",["$","a",null,{"href":"https://github.com/kubernetes-sigs/kind","children":"kind"}]," offer local clusters, however it will not expose you to the reality of running a cluster on multiple nodes. ",["$","a",null,{"href":"#user-content-fnref-1","data-footnote-backref":true,"className":"data-footnote-backref","aria-label":"Back to content","children":"↩"}]]}],"\n"]}],"\n",["$","li",null,{"id":"user-content-fn-2","children":["\n",["$","p",null,{"children":["In practice each agent consume some resources to run the Kubernetes components (network and node controller), so the article assumes 1Go less of RAM available and 200m less of cpu. ",["$","a",null,{"href":"#user-content-fnref-2","data-footnote-backref":true,"className":"data-footnote-backref","aria-label":"Back to content","children":"↩"}]]}],"\n"]}],"\n",["$","li",null,{"id":"user-content-fn-3","children":["\n",["$","p",null,{"children":["This comes from my own experience and was acknowledged by their support in 2022. ",["$","a",null,{"href":"#user-content-fnref-3","data-footnote-backref":true,"className":"data-footnote-backref","aria-label":"Back to content","children":"↩"}]]}],"\n"]}],"\n",["$","li",null,{"id":"user-content-fn-4","children":["\n",["$","p",null,{"children":["The Hetzner community maintains also a great ",["$","a",null,{"href":"https://github.com/kube-hetzner/terraform-hcloud-kube-hetzner","children":"Terraform module"}],". ",["$","a",null,{"href":"#user-content-fnref-4","data-footnote-backref":true,"className":"data-footnote-backref","aria-label":"Back to content","children":"↩"}]]}],"\n"]}],"\n"]}],"\n"]}]]}]
4:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"Low-cost Kubernetes cluster on Infomaniak"}],["$","meta","3",{"name":"description","content":"How to deploy k8s on a $30.— monthly budget or less."}],["$","link","4",{"rel":"icon","href":"/icon.svg?a05afc09b4abba7d","type":"image/svg+xml","sizes":"any"}],["$","meta","5",{"name":"next-size-adjust"}]]
9:null
